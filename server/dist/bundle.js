/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={486:e=>{"use strict";e.exports=require("bcrypt")},268:e=>{"use strict";e.exports=require("body-parser")},577:e=>{"use strict";e.exports=require("cors")},818:e=>{"use strict";e.exports=require("dotenv")},252:e=>{"use strict";e.exports=require("express")},675:e=>{"use strict";e.exports=require("firebase-admin")},45:e=>{"use strict";e.exports=require("image-size")},829:e=>{"use strict";e.exports=require("jsonwebtoken")},461:e=>{"use strict";e.exports=require("multer")},12:e=>{"use strict";e.exports=require("mysql2")},498:e=>{"use strict";e.exports=require("mysql2/promise")},572:e=>{"use strict";e.exports=require("nodemailer")},278:e=>{"use strict";e.exports=require("pdfkit")},903:e=>{"use strict";e.exports=require("uuid")},751:e=>{"use strict";e.exports=require("xlsx")},236:e=>{"use strict";e.exports=require("console")},896:e=>{"use strict";e.exports=require("fs")},774:e=>{"use strict";e.exports=JSON.parse('{"type":"service_account","project_id":"paplapplication","private_key_id":"4adbf847ee15724f71ad6b8c93f2a0a7abe9a6a5","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQD0ldxiRO/n++uE\\nCF1BsY7JueTANC4YY7CBw4X3SCFrdEcZV/8PdUF8z5FpanoTB41A5qhCMLNCDCAJ\\nd6jo9bYHUlMJmR6Y2agLGZ+5qRK37+/H3uMCfppsdVl6tlbDnrxBcos4GZKPgZIB\\nV7kTJiZJKK9HniOH3hEg44Fv0JFnbglcu0MZJ5V6fj6jdzO7qefZjfPLsPHXmSGr\\n3y/tqrKquU07Hi2EpO5DCoclWQ34ckRQyZXuT/7MbjoVJWw3VUt5MVql3liO9K+q\\nbLPEGebgzbiB5YE6VBu1RfflcrERuRDPFaKdll8h1aC6xgdq1w+C/i88PSskvQFK\\nUQSoeGshAgMBAAECggEACH9wccWdZDz/eM3ll5O4t0+LIBZwB47nIgsOC4JpDtey\\nZLIG/Z2AUfrQPY5igWjAwqGA9RPGFqRfNJUAvF9VHLoCgpHcW0ksqn4Qa53xNYzT\\nkukuj/agHOaS3k2ZhCBuwANfzOouimfhD8ThfEXWDLKqLF3VNDJF/BOLerwPYT2D\\nF6vGe2wP7DUpCjxl2iMZIrgQP0BD9zenQJqmfHXh3PYT1rM1jyGCTtOvjn4G28Ps\\n6hs4JCeVZulr202TsGcS27Gib8/UPDauF3T/MIhIC+oz27cNn2Va4mN448BcrWPg\\ngRldgn+I1jlGia8fwxsTZkVQBWpLQVEd0xCG0Ck1AQKBgQD+8Lb/ggiWn44X4pJ7\\nIxUfn+TAc0JsvyJLl2GX+FrKrVJPs8ZvSLj3x2UpFrcqTHjcT3CDyvx3ydTPolwQ\\n9D03WDWvYqV0iFxuaMaRN0MdSe6Q0hspRoM11dEqZhwP9WsmZmqQYmzIXBm1TJWu\\n7ntQOdsjAHVFn+lpujo5LadqUQKBgQD1miCULfBpS3hGTSe3+UaASp2DBaBp8is7\\nPKN4zZVZyQRptcU4Lk9pr0BdBnjQPrfIsLi4Q/YmJ0VYYNyVKkYlIbb13XHGOjWC\\nHMMuaHi7Zrlnji8ncfakd96RGRzK9j284MG2nft0nwvFUlg1KEetmG50X39qymDJ\\nWS80ornv0QKBgQCQLATxPdIpjBXJQCJibJaXic7NXuEjqnt0kClqzdJaZ+XymNIR\\nQOkJhsOYlvYCf7ihrnMMtRBNleA5g7HZDKZJ1CKYCotS+YJ8FdilasEToSm+0HL3\\nxp6RJVfiSFh6VenAj46YFHE8ZYlMVAEaKlemKPHaO3oWY7aWSfB/QWg54QKBgFmF\\nZHqehBLdP2nglampYtlAWUl4s4/qhXeCEtPlm5quer1NVCW2O5v6FSvTQBYnxjWQ\\ntMP1gbNGfTBJnh2A2zCNqXLU1LO8Y+SZN0ujKN6mAs6MNQPbtlscljOtQ6F3P+mo\\nwvMdgppvnoq+CQjXNclA1oH0jS0Pt1es+lflOIEBAoGBAPjnh2CpWFUHdU7MQ8L3\\n31YJ2P/TfNtMAi1bl40ksxvhfikpS2JkHo9XU4K5ZTFqbnNsdmVLc2wJkSu40zSs\\nBnMmsqltBc81Gygx3CCgsXx7zBsAIWPBmwMIWjaPEx0Roh2pKGZ9hKHpo6nxEPL4\\nr3sJRLZqfPgVSEV49Np0by07\\n-----END PRIVATE KEY-----\\n","client_email":"firebase-adminsdk-dlrxg@paplapplication.iam.gserviceaccount.com","client_id":"101826401645123318858","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-dlrxg%40paplapplication.iam.gserviceaccount.com","universe_domain":"googleapis.com"}')}},r={};function t(o){var n=r[o];if(void 0!==n)return n.exports;var s=r[o]={exports:{}};return e[o](s,s.exports,t),s.exports}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function n(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=i(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,s=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw s}}}}function s(){"use strict";s=function(){return r};var e,r={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,r,t){e[r]=t.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function d(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{d({},"")}catch(e){d=function(e,r,t){return e[r]=t}}function _(e,r,t,o){var n=r&&r.prototype instanceof v?r:v,s=Object.create(n.prototype),i=new L(o||[]);return a(s,"_invoke",{value:N(e,t,i)}),s}function p(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}r.wrap=_;var f="suspendedStart",m="suspendedYield",g="executing",E="completed",y={};function v(){}function h(){}function b(){}var S={};d(S,c,(function(){return this}));var j=Object.getPrototypeOf,R=j&&j(j(I([])));R&&R!==t&&n.call(R,c)&&(S=R);var T=b.prototype=v.prototype=Object.create(S);function D(e){["next","throw","return"].forEach((function(r){d(e,r,(function(e){return this._invoke(r,e)}))}))}function w(e,r){function t(s,a,i,c){var u=p(e[s],e,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==o(d)&&n.call(d,"__await")?r.resolve(d.__await).then((function(e){t("next",e,i,c)}),(function(e){t("throw",e,i,c)})):r.resolve(d).then((function(e){l.value=e,i(l)}),(function(e){return t("throw",e,i,c)}))}c(u.arg)}var s;a(this,"_invoke",{value:function(e,o){function n(){return new r((function(r,n){t(e,o,r,n)}))}return s=s?s.then(n,n):n()}})}function N(r,t,o){var n=f;return function(s,a){if(n===g)throw Error("Generator is already running");if(n===E){if("throw"===s)throw a;return{value:e,done:!0}}for(o.method=s,o.arg=a;;){var i=o.delegate;if(i){var c=O(i,o);if(c){if(c===y)continue;return c}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(n===f)throw n=E,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);n=g;var u=p(r,t,o);if("normal"===u.type){if(n=o.done?E:m,u.arg===y)continue;return{value:u.arg,done:o.done}}"throw"===u.type&&(n=E,o.method="throw",o.arg=u.arg)}}}function O(r,t){var o=t.method,n=r.iterator[o];if(n===e)return t.delegate=null,"throw"===o&&r.iterator.return&&(t.method="return",t.arg=e,O(r,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),y;var s=p(n,r.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,y;var a=s.arg;return a?a.done?(t[r.resultName]=a.value,t.next=r.nextLoc,"return"!==t.method&&(t.method="next",t.arg=e),t.delegate=null,y):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,y)}function q(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function k(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(q,this),this.reset(!0)}function I(r){if(r||""===r){var t=r[c];if(t)return t.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var s=-1,a=function t(){for(;++s<r.length;)if(n.call(r,s))return t.value=r[s],t.done=!1,t;return t.value=e,t.done=!0,t};return a.next=a}}throw new TypeError(o(r)+" is not iterable")}return h.prototype=b,a(T,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:h,configurable:!0}),h.displayName=d(b,l,"GeneratorFunction"),r.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===h||"GeneratorFunction"===(r.displayName||r.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,d(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},r.awrap=function(e){return{__await:e}},D(w.prototype),d(w.prototype,u,(function(){return this})),r.AsyncIterator=w,r.async=function(e,t,o,n,s){void 0===s&&(s=Promise);var a=new w(_(e,t,o,n),s);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},D(T),d(T,l,"Generator"),d(T,c,(function(){return this})),d(T,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var r=Object(e),t=[];for(var o in r)t.push(o);return t.reverse(),function e(){for(;t.length;){var o=t.pop();if(o in r)return e.value=o,e.done=!1,e}return e.done=!0,e}},r.values=I,L.prototype={constructor:L,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!r)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var t=this;function o(o,n){return i.type="throw",i.arg=r,t.next=o,n&&(t.method="next",t.arg=e),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],i=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=r&&r<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=r,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(a)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),y},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),k(t),y}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var o=t.completion;if("throw"===o.type){var n=o.arg;k(t)}return n}}throw Error("illegal catch attempt")},delegateYield:function(r,t,o){return this.delegate={iterator:I(r),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=e),y}},r}function a(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var o,n,s,a,i=[],c=!0,u=!1;try{if(s=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(o=s.call(t)).done)&&(i.push(o.value),i.length!==r);c=!0);}catch(e){u=!0,n=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw n}}return i}}(e,r)||i(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,r){if(e){if("string"==typeof e)return c(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,r):void 0}}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=Array(r);t<r;t++)o[t]=e[t];return o}function u(e,r,t,o,n,s,a){try{var i=e[s](a),c=i.value}catch(e){return void t(e)}i.done?r(c):Promise.resolve(c).then(o,n)}function l(e){return function(){var r=this,t=arguments;return new Promise((function(o,n){var s=e.apply(r,t);function a(e){u(s,o,n,a,i,"next",e)}function i(e){u(s,o,n,a,i,"throw",e)}a(void 0)}))}}var d=t(268),_=t(252),p=t(577),f=t(461),m=t(12),g=t(498),E=t(486),y=t(829),v=t(572),h=t(903).v4,b=t(903),S=f.memoryStorage(),j=f({storage:S}),R=f.diskStorage({destination:function(e,r,t){t(null,"uploads/images")},filename:function(e,r,t){t(null,r.originalname)}}),T=f({storage:R}),D=t(896),w=(t(278),t(45),process.env.PORT||3e3),N=_(),O=t(751);t(236).log,t(278),N.use(p()),N.use(_.json()),N.use(d.json({limit:"50mb"})),N.use(d.urlencoded({limit:"50mb",extended:!0}));try{var q=t(675),k=t(774);q.initializeApp({credential:q.credential.cert(k),databaseURL:"https://paplapplication-default-rtdb.firebaseio.com"}),q.database().ref("/").once("value",(function(e){q.database().ref("/Leave/Leaveforleadknown/krishnannarayananpaplcorpcom")})).catch((function(e){console.error("Firebase initialization error:",e)}))}catch(e){console.error(e.message)}t(818).config();var L=process.env.DB_HOST,I=process.env.DB_USER,A=(process.env.DB_PASSWORD,process.env.SQL_DATABASE1,process.env.SQL_DATABASE2,process.env.SERVER_URL),M=process.env.CLIENT_URL;console.log("DB Host:",L),console.log("DB User:",I),console.log("Server URL:",A),console.log("Client URL:",M);var x=m.createConnection({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.SQL_DATABASE1||"paplworkspace"}),C=m.createConnection({host:process.env.DB_HOST||"127.0.0.1",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.SQL_DATABASE2||"papl_inspection"}),F=g.createPool({host:process.env.DB_HOST||"127.0.0.1",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.SQL_DATABASE2||"papl_inspection",waitForConnections:!0,connectionLimit:10,queueLimit:0}),P=process.env.CLEINT_URL+"/Mail_Response"||0;x.connect((function(e){e?console.error("Error",e):console.log("Connected to MySQL Papl Client Database")})),C.connect((function(e){e?console.error("Error connecting to MySQL:",e):console.log("Connected to MySQL Papl Inspection")})),N.get("/api/next-id",(function(e,r){C.query("SELECT IFNULL(MAX(id) + 1, 1) AS next_id FROM uploaded_files",(function(e,t,o){if(e)throw e;r.json(t[0].next_id)}))})),N.get("/api/get_Master_Value_for_DB",(function(e,r){C.query("SELECT DISTINCT(security) FROM inspection_master",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});C.query("SELECT id, Product, Parts, Description, Reference, Risklevel, Photo, Dropdown, functional_point, Positive_MNT, Positive_ADJ, Negative_MNT, Negative_ADJ, Emergency_Features, Customer_Scope, security FROM inspection_master",(function(e,o){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});if(1===t.length){var n=[];o.forEach((function(e){var r=e.Parts.trim().toLowerCase().replace(/ /g,"_");n[r]||(n[r]=[]),n[r].push(e)}));var s={key:t[0].security};Object.keys(n).forEach((function(e){s[e]=n[e]})),r.json(s)}else r.status(404).json({error:"No security keys found"})}))}))})),N.get("/api/checkKey_DB",(function(e,r){var t=e.query.key;C.query("SELECT DISTINCT( security) FROM inspection_master WHERE 1;",(function(e,o){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});if(1==o.length){var n=o.some((function(e){return e.security===t}));r.json(n)}else r.json(!1)}))})),N.get("/getImage/:document_id",(function(e,r){var t=e.params.document_id;C.query("SELECT filedata FROM file WHERE document_id = ?",[t],(function(e,t,o){if(e)return console.error("Error fetching image data:",e),r.status(500).send("Error fetching image data.");if(0===t.length)return r.status(404).send("Image data not found.");var n=t[0].filedata;r.send(n)}))})),N.post("/uploadFile",T.single("fileUpload"),(function(e,r){var t=e.body.document_id;try{if(!e.file)return r.status(400).send("No file uploaded.");D.readFile(e.file.path,(function(o,n){if(o)return console.error("Error reading file:",o),r.status(500).send("Error reading file.");C.query("DELETE FROM file WHERE document_id = ?",[t],(function(o,s){if(o)return console.error("Error deleting existing record:",o),r.status(500).send("Error deleting existing record.");D.unlink(e.file.path,(function(e){e&&console.error("Error deleting temporary file:",e)}));var a=[e.file.originalname,n,t];C.query("INSERT INTO file (filename, filedata, document_id) VALUES (?, ?, ?)",a,(function(e,t,o){if(e)return console.error("Error inserting file data:",e),r.status(500).send("Error uploading file.");console.log("File data inserted successfully:",t),r.status(200).json({message:"File uploaded successfully."})}))}))}))}catch(e){console.error("Error uploading file:",e),r.status(500).send("Internal server error.")}})),N.post("/api/upload_certificate",j.single("file"),(function(e,r){if(!e.file)return r.status(400).send("No file uploaded.");var t=e.file.buffer,o=(e.file.filename,e.body),n=o.unit_name,s=o.document_id,a=o.building_name,i=o.contract,c=o.inspector_name;function u(){C.query("INSERT INTO uploaded_files (unit_name, document_id, file_data, building_name, contract, inspector_name) VALUES (?, ?, ?, ?, ?, ?)",[n,s,t,a,i,c],(function(e,t){if(e)return console.error("Error saving file details to database:",e),r.status(500).json({error:"Error saving file details to database."});console.log("File details and data saved to database:",t),r.status(200).json({message:"File uploaded and details saved to database."})}))}C.query("SELECT COUNT(*) AS count FROM uploaded_files WHERE unit_name = ? AND document_id = ? AND building_name = ? AND contract = ? AND inspector_name = ?",[n,s,a,i,c],(function(e,t){if(e)return console.error("Error checking existing record:",e),r.status(500).json({error:"Error checking existing record."});t[0].count>0?C.query("DELETE FROM uploaded_files WHERE unit_name = ? AND document_id = ? AND building_name = ? AND contract = ? AND inspector_name = ?",[n,s,a,i,c],(function(e,t){if(e)return console.error("Error deleting existing record:",e),r.status(500).json({error:"Error deleting existing record."});console.log("Existing record deleted."),u()})):u()}))})),N.post("/api/upload_report",j.single("file"),(function(e,r){if(!e.file)return r.status(400).send("No file uploaded.");var t=e.file.buffer,o=(e.file.filename,e.body),n=o.unit_name,s=o.document_id,a=o.building_name,i=o.contract,c=o.inspector_name;function u(){C.query("INSERT INTO report_files (unit_name, document_id, file_data, building_name, contract, inspector_name) VALUES (?, ?, ?, ?, ?, ?)",[n,s,t,a,i,c],(function(e,t){if(e)return console.error("Error saving file details to database:",e),r.status(500).json({error:"Error saving file details to database."});console.log("File details and data saved to database:",t),r.status(200).json({message:"File uploaded and details saved to database."})}))}C.query("SELECT COUNT(*) AS count FROM report_files WHERE unit_name = ? AND document_id = ? AND building_name = ? AND contract = ? AND inspector_name = ?",[n,s,a,i,c],(function(e,t){if(e)return console.error("Error checking existing record:",e),r.status(500).json({error:"Error checking existing record."});t[0].count>0?C.query("DELETE FROM report_files WHERE unit_name = ? AND document_id = ? AND building_name = ? AND contract = ? AND inspector_name = ?",[n,s,a,i,c],(function(e,t){if(e)return console.error("Error deleting existing record:",e),r.status(500).json({error:"Error deleting existing record."});console.log("Existing record deleted."),u()})):u()}))})),N.get("/api/getQuality_emergency",(function(e,r){var t=e.query,o=t.doc_id,n=t.unit_array.split(",");console.log("##",o,n),C.query("SELECT  unit_no, description, dropdown_option, checked, section, Positive_MNT, Positive_ADJ, Negative_MNT, Negative_ADJ, Emergency_Features, Customer_Scope FROM record_values WHERE Emergency_Features=? AND unit_no IN (?) AND document_id =?",[1,n,o],(function(e,t){return e?(console.error("Error fetching data from database:",e),void r.status(500).json({error:"Internal Server Error"})):0===t.length?void r.status(404).json({error:"Data no found"}):r.json(t)}))})),N.get("/api/getChecklist_Record_Val_with_unit",(function(e,r){var t=e.query,o=t.doc_id,n=t.unit_array.split(",");console.log("parsed val",n,o),C.query("SELECT id, document_id, inspector_name, unit_no, description, dropdown_option, checked,  needforReport, section, Positive_MNT, Positive_ADJ, Negative_MNT, Negative_ADJ, Emergency_Features, Customer_Scope FROM  record_values WHERE document_id = ?  AND unit_no IN (?)",[o,n],(function(e,t){return e?(console.error("Error fetching record values:",e),r.status(500).json({error:"Internal server error"})):0===t.length?r.status(404).json({error:"No record values found"}):(t.forEach((function(e,o){if(null!=e.img&&e.checked){var n=e.img;r.setHeader("Content-Type","image/jpeg"),console.log("working",e.description),t[o].img=n}else t[o].img=null})),r.send(t))}))})),N.post("/addUnitDetails",(function(e,r){var t=e.body,o=t.unitArray,n=(t.contract,t.doc);C.query("SELECT report_array FROM unit_details WHERE document_id = ?",[n],(function(e,t,s){if(e)return console.error("Error fetching report_array:",e),r.status(500).json({error:"Error fetching report_array"});var a,i=[];t.length>0&&t[0].report_array&&(i=JSON.parse(t[0].report_array)),i.length>0?(a=i.concat([o]),C.query("UPDATE unit_details SET report_array = ? WHERE document_id = ?",[JSON.stringify(a),n],(function(e,t,o){return e?(console.error("Error updating unit details:",e),r.status(500).json({error:"Error updating unit details"})):(console.log("Unit details updated successfully"),r.status(200).json({success:!0}))}))):(a=[o],C.query("UPDATE unit_details SET report_array = ? WHERE document_id = ?",[JSON.stringify(a),n],(function(e,t,o){return e?(console.error("Error inserting unit details:",e),r.status(500).json({error:"Error inserting unit details"})):(console.log("Unit details inserted successfully"),r.status(200).json({success:!0}))})))}))})),N.get("/api/get_pdf",(function(e,r){var t=e.query,o=t.id,n=t.unit;if(!o)return r.status(400).send("ID parameter is required.");C.query("SELECT file_data FROM uploaded_files WHERE document_id = ? and unit_name =?",[o,n],(function(e,t){if(e)return console.error("Error fetching PDF data from MySQL:",e),r.status(500).send("Error fetching PDF data from MySQL.");if(0===t.length)return r.status(404).send("PDF not found in MySQL.");var o=t[0].file_data;r.contentType("application/pdf").send(o)}))})),N.get("/api/get_pdf1",(function(e,r){var t=e.query,o=t.id,n=t.unit;if(!o)return r.status(400).send("ID parameter is required.");C.query("SELECT file_data FROM report_files WHERE document_id = ? and unit_name =?",[o,n],(function(e,t){if(e)return console.error("Error fetching PDF data from MySQL:",e),r.status(500).send("Error fetching PDF data from MySQL.");if(0===t.length)return r.status(404).send("PDF not found in MySQL.");var o=t[0].file_data;r.contentType("application/pdf").send(o)}))})),N.get("/api/upload_files_fetch",(function(e,r){var t=e.query.encodedValue;console.log("inspector name in view certificate is",t),C.query("SELECT * FROM uploaded_files where inspector_name='".concat(t,"'"),(function(e,t,o){if(e)return r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/upload_report_fetch",(function(e,r){var t=e.query.name;console.log("report inspector name",t),C.query("SELECT * FROM report_files WHERE inspector_name = ?",[t],(function(e,t,o){if(e)return console.log(e),r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/reject_report_fetch",(function(e,r){var t=e.query.name;console.log("report inspector name",t),C.query("SELECT * FROM report_files WHERE inspector_name = ? and reject=?",[t,1],(function(e,t,o){if(e)return console.log(e),r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/upload_report_fetch1",(function(e,r){var t=e.query.name;console.log("report inspector name",t),C.query("SELECT * FROM report_files WHERE inspector_name = ? and report_status=?",[t,1],(function(e,t,o){if(e)return console.log(e),r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/unit_fetch",(function(e,r){C.query("SELECT * FROM unit_details WHERE head = ? AND closing_flag = ?",[1,0],(function(e,t,o){if(e)return r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/feed_back_fetch",(function(e,r){C.query("SELECT * FROM unit_details WHERE head = ? AND feed_back = ?",[1,0],(function(e,t,o){if(e)return r.status(500).json({message:e.message});r.json(t)}))})),N.get("/api/upload_files_fetch/:id/pdf",function(){var e=l(s().mark((function e(r,t){var o,n,i,c,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.params.id,e.prev=1,e.next=4,C.execute("SELECT pdf_data FROM uploaded_files WHERE id = ?",[o]);case 4:if(n=e.sent,i=a(n,2),c=i[0],i[1],0!==c.length){e.next=10;break}return e.abrupt("return",t.status(404).send("PDF not found."));case 10:u=c[0].pdf_data,t.setHeader("Content-Type","application/pdf"),t.send(u),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error fetching PDF:",e.t0),t.status(500).send("Internal Server Error");case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(r,t){return e.apply(this,arguments)}}());var H=function(){return new Promise((function(e,r){x.execute("SELECT App_password, Email, Organization FROM mail_automation",(function(t,o){if(t)r(t);else{for(var n=null,s=0;s<o.length;s++)if(o[s].App_password&&o[s].Email&&o[s].Organization){n={user:o[s].Email,pass:o[s].App_password},console.log("Email:",n.user),console.log("Password:",n.pass);break}n?e(n):r(new Error("Transporter data not found"))}}))}))};function U(){return(U=l(s().mark((function e(){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H();case 3:r=e.sent,console.log("Transporter data:",r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){U.apply(this,arguments)}();var W=function(){var e=l(s().mark((function e(r,t,o){var n,a,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H();case 3:n=e.sent,a=v.createTransport({service:"Gmail",auth:{user:n.user,pass:n.pass}}),i=process.env.SERVER_URL+"/api/verify-email?email=".concat(r,"&token=").concat(t),c={from:n.user,to:r,subject:"Email Verification",html:'Click the following link to verify your email: <a href="'.concat(i,'">').concat(i,"</a>")},a.sendMail(c,(function(e,r){e?console.error("Email sending error:",e):console.log("Email sent:",r.response)})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error sending email:",e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r,t,o){return e.apply(this,arguments)}}(),J=function(){var e=l(s().mark((function e(r,t,o){var n,a,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,H();case 3:n=e.sent,a=v.createTransport({service:"Gmail",auth:{user:n.user,pass:n.pass}}),i=process.env.SERVER_URL+"/api/verify-email?email=".concat(r,"&token=").concat(t),c={from:n.user,to:r,subject:"Email Verification",html:'Click the following link to verify your email: <a href="'.concat(i,'">').concat(i,"</a>")},a.sendMail(c,(function(e,r){e?console.error("Email sending error:",e):console.log("Email sent:",r.response)})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error sending email:",e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r,t,o){return e.apply(this,arguments)}}();function V(e){return Q.apply(this,arguments)}function Q(){return(Q=l(s().mark((function e(r){var t,o,i,c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],o=n(r),e.prev=2,o.s();case 4:if((i=o.n()).done){e.next=23;break}return c=i.value,e.prev=7,e.next=10,F.query("SELECT `NAME`, `designation`, `contact_no`, `email_id` FROM `emp_data` WHERE `PSN_NO` = ?",[c]);case 10:u=e.sent,l=a(u,2),d=l[0],l[1],t.push(d[0]),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(7),console.error("Error fetching data:",e.t0.message),t.push({});case 21:e.next=4;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(2),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:return e.abrupt("return",t);case 32:case"end":return e.stop()}}),e,null,[[2,25,28,31],[7,17]])})))).apply(this,arguments)}N.get("/api/getinfdata_forMail",(function(e,r){var t=e.query.id;C.query("SELECT  id,contract_number, location, master_customer_name, customer_workorder_name, customer_workorder_date, type_of_inspection, project_name, customer_contact_mailid, no_of_mandays_as_per_work_order, total_units_schedule, schedule_from, schedule_to, inspection_time_ins, inspector_list FROM inf_26 WHERE id=?",[t],(function(e,t){if(!e){t[0].inspector_list=JSON.parse(t[0].inspector_list).filter((function(e){return""!==e.trim()}));var o=new Date(t[0].customer_workorder_date);t[0].customer_workorder_date=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(o);var n=new Date(t[0].schedule_from);t[0].schedule_from=new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",weekday:"long"}).format(n);var s=new Date(t[0].schedule_to);t[0].schedule_to=new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",weekday:"long"}).format(s);var a=t[0].inspection_time_ins.match(/\(([^)]+)\)/);return a&&(t[0].inspection_time_ins=a[1]),r.json(t)}console.log("Error"),r.status(500).json({success:!1,message:"Internal server error."})}))})),N.get("/api/checkContract_Avai_INF",(function(e,r){var t=e.query.contract;C.query("SELECT id FROM inf_26 WHERE contract_number = ?",[t],(function(e,t){if(t)return r.json(t)}))})),N.get("/api/getinfdata_forReport",(function(e,r){var t=e.query.id;C.query("SELECT id, location,building_name, master_customer_name, customer_workorder_name, customer_workorder_date, type_of_inspection, project_name, customer_contact_mailid, no_of_mandays_as_per_work_order, total_units_schedule, schedule_from, schedule_to, inspection_time_ins,oem_details,inspector_array FROM inf_26 WHERE contract_number = ?",[t],(function(e,t){if(!e){if(t.length>0){console.log("Before",t);var o=new Date(t[0].customer_workorder_date);t[0].customer_workorder_date=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).format(o);var n=new Date(t[0].schedule_from);t[0].schedule_from=new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",weekday:"long"}).format(n);var s=new Date(t[0].schedule_to);t[0].schedule_to=new Intl.DateTimeFormat("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",weekday:"long"}).format(s);var a=t[0].inspection_time_ins.match(/\(([^)]+)\)/);return a&&(t[0].inspection_time_ins=a[1]),r.json(t)}return r.json(null)}console.log("Error"),r.status(500).json({success:!1,message:"Internal server error."})}))})),N.get("/api/getUnit_details_Report",(function(e,r){var t=e.query.contact_num;C.query("SELECT `document_id`, `contract_number`, `unit_no`, `witness_details`, `inspector_name`, `building_name` FROM `unit_details` WHERE `contract_number`=?",[t],(function(e,t){if(t)return r.json(t)}))})),N.get("/api/getBrief_spec_value",(function(e,r){var t,o=e.query.docid;console.log("docid",o);try{console.log("unit_id",e.query.unit_id),t=e.query.unit_id.split(",")}catch(e){return r.status(400).json({message:"Invalid unit_id format"})}console.log("unit_id",t),console.log("unit_id length",t.length);var n="SELECT * FROM `breif_spec` WHERE document_id = ? AND unit_no IN (?)",s=[o,t];console.log("SQL Query:",n),C.query(n,s,(function(e,t){return e?(console.error("Database error:",e),r.status(500).json({message:"Internal server error"})):(console.log("Result:",t.length,t),r.json(t))}))})),N.get("/api/getinsectionmasterData",(function(e,r){console.log("inspection master server called");var t="SELECT * FROM `inspection_master` WHERE 1";console.log("SQL Query:",t),C.query(t,(function(e,t){return e?(console.error("Database error:",e),r.status(500).json({message:"Internal server error"})):r.json(t)}))})),N.get("/api/getinspectionmaster_description_for_Variable",(function(e,r){var t=e.query.part;C.query("SELECT    `Description` FROM `inspection_master` WHERE `Parts`=?",[t],(function(e,t){if(t)return r.json(t)}))})),N.get("/api/getChecklist_Record_Val",(function(e,r){var t=e.query.doc_id;C.query("SELECT `id`, `document_id`, `inspector_name`, `unit_no`, `description`, `dropdown_option`, `checked`, `img`, `needforReport`, `section`,`risk_level` FROM `record_values` WHERE `document_id`=?",[t],(function(e,t){if(t)return r.json(t)}))})),N.get("/records",(function(e,r){var t=e.query,o=t.document_id,n=t.unit_no;C.query("SELECT * FROM record_values WHERE document_id = ? AND unit_no = ?",[o,n],(function(e,t){if(e)return console.error("Error executing query: "+e.stack),void r.status(500).send("Internal Server Error");r.json(t)}))})),N.get("/api/getInspectordata_forMail",function(){var e=l(s().mark((function e(r,t){var o,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=r.query.inspectors,n=/\b\d+\b/g,a=o.match(n),e.next=6,V(a);case 6:return i=e.sent,e.abrupt("return",t.json(i));case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error:",e.t0.message),e.abrupt("return",t.status(500).json({error:"Internal Server Error"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r,t){return e.apply(this,arguments)}}()),N.get("/api/getMailSetupdata_forMail",(function(e,r){var t=e.query.organization;console.log(t),x.query("SELECT App_password, Email FROM mail_automation WHERE Organization=?",[t],(function(e,t){return t.length>0?r.json(t):r.status(404).json({message:"No data found for the organization"})}))}));var B=[];function z(e){return G.apply(this,arguments)}function G(){return(G=l(s().mark((function e(r){var t,o,i,c,u,l,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],o=n(r),e.prev=2,o.s();case 4:if((i=o.n()).done){e.next=22;break}return c=i.value,e.prev=7,e.next=10,F.query("SELECT `pdf` FROM `pdf_cv` WHERE `PSN_NO`= ?",[c]);case 10:u=e.sent,l=a(u,2),d=l[0],l[1],void 0!==d[0]&&null!==d[0]&&t.push(d[0]),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),console.error("Error fetching data:",e.t0.message);case 20:e.next=4;break;case 22:e.next=27;break;case 24:e.prev=24,e.t1=e.catch(2),o.e(e.t1);case 27:return e.prev=27,o.f(),e.finish(27);case 30:return e.abrupt("return",t);case 31:case"end":return e.stop()}}),e,null,[[2,24,27,30],[7,17]])})))).apply(this,arguments)}function Y(e){var r={},t={};return e.forEach((function(e){var r=e.Parts.toUpperCase(),o=e.Description.trim().toUpperCase(),n=e.Dropdown.split("~").map((function(e){return e.trim()}));t[r]||(t[r]={incrementValue:1,values:{}});var s=t[r].incrementValue;t[r].values[s]||(t[r].values[s]={Description:o,Dropdown:{}}),n.forEach((function(e,o){t[r].values[s].Dropdown[o+1]=e})),t[r].incrementValue++})),Object.keys(t).forEach((function(e){var o=t[e].values;r[e]=o})),r}N.get("/api/getInspector_CV_data_forMail",function(){var e=l(s().mark((function e(r,t){var o,n,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=r.query.inspectors,n=/\b\d+\b/g,a=o.match(n),e.next=6,z(a);case 6:return B=e.sent,e.abrupt("return",t.json(B));case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error:",e.t0.message),e.abrupt("return",t.status(500).json({error:"Internal Server Error"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r,t){return e.apply(this,arguments)}}()),N.post("/api/sendmailtocli",function(){var e=l(s().mark((function e(r,t){var o,n,a,i,c,u,l,d,_,p,f,m,g,E,y,h,b,S,j,R,T,D,w,N,O,q;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.body,n=o.id,a=o.customername,i=o.totalunit,c=o.projectname,u=o.location,l=o.contract_number,d=o.customer_workorder_name,_=o.from,p=o.to,f=o.noOfDays,m=o.inspectionType,g=o.inspectionTime,E=o.customerMail,y=o.emailIds_CC,h=o.inspectorData,o.appPassword,o.senderEmail,b=o.inspectors,console.log("difference between days",f),console.log("customer name",a),e.prev=3,S=[],j=/-\s(\d+)/,b.forEach((function(e){var r=e.match(j);r&&r[1]&&S.push(r[1])})),e.next=9,H();case 9:return R=e.sent,T=v.createTransport({service:"Gmail",auth:{user:R.user,pass:R.pass}}),D=function(e){var r=1;return e.map((function(e){return'\n          <tr>\n            <td style="padding-left: 10px;color: black;">'.concat(r++,'</td>\n            <td style="padding-left: 10px;color: black;">').concat(e[1],'</td>\n            <td style="padding-left: 10px;color: black;">').concat(e[3],'</td>\n            <td style="padding-left: 10px;color: black;">').concat(e[5],'</td>\n            <td style="padding-left: 10px;color: black;">').concat(e[7],"</td>\n          </tr>\n        ")})).join("")},w='\n    <p style="color: black;">Dear Sir/Madam,</p>\n    <p style="color: black;">Kind Attention:<b> '.concat(a,'</b> </p>\n    <p style="color: black;">Thank you for your order for the inspection of <b>').concat(i," Units</b> at <b> ").concat(c,"-").concat(u,'</b></p>\n    <p style="color: black;">Please note the following:-</p>\n    <div style="padding-left: 20px;">\n    <table width="600" height="20" border="1" >\n        <tr>\n            <td style="padding: 4px;color: black;" >PAPL Order Reference</td>\n            <td style="padding: 4px;color: black;  font-weight:bold" colspan="4">').concat(l,'</td></tr>\n            <tr>\n            <td style="padding: 4px;color: black;" >Customer Order Reference</td>\n            <td style="padding: 4px;color: black;" colspan="4">').concat(d,'</td>\n        </tr>\n        <tr>\n           <td style="padding: 4px; color: black;" rowspan="2"> Proposed Inspection Dates</td> \n           <td style="padding: 4px;color: black;" rowspan="1" colspan="2">Inspection Start Date</td>\n          <td style="padding: 4px;color: black;">').concat(_,'</td></tr>\n          <tr>\n          <td style="padding: 4px;color: black;">Inspection End Date</td>\n          <td style="padding: 4px;color: black;" rowspan="1" colspan="2">').concat(p,'</td>\n        </tr>\n        \n        <tr>\n            <td style="padding: 4px;color: black;" >Inspection Type</td>\n            <td style="padding: 4px;color: black;" colspan="4">').concat(m,'</td>\n        </tr>\n        <tr>\n            <td style="padding: 4px;color: black;" >Calibrated instruments carried by us</td>\n            <td style="padding: 4px;color: black;" colspan="4">Metal Scale, Taper Scale, Measuring Tape</td>\n        </tr>\n    </table>\n    </div>\n    <br>\n    <p style="color: black;"><b> The inspection will be carried out between ').concat(g,'.</b></p>\n    <p style="color: black;">The Inspection will be conducted by the following personnel (Credentials Attached) and request you kindly process the entry Pass accordingly.</p>\n    <div style="padding-left: 20px;">\n    <table border="1">\n        <tr>\n            <th style="color: black;">SL. NO</th>\n            <th style="color: black;">NAME</th>\n            <th style="color: black;">DESIGNATION</th>\n            <th style="color: black;">MOBILE</th>\n            <th style="color: black;">E-MAIL ID</th>\n        </tr>\n        \n        \n        ').concat(D(h),'\n        \n    </table>\n    </div>\n    <br>\n    <p style="color: black;">Representatives of OEM/ Service providers at the supervisory level with adequate manpower <b>(One Technical Person per Inspector)</b> and tools as listed below should be made available throughout the inspection for coordination and support.</p>\n    <p style="color: black;">We need -: </p>\n    <div style="padding-left: 20px;">\n          <p style="color: black;">1. Permission to enter the premises</p>\n    \n        <p style="color: black;">2. Permission to travel on Equipment, enter the Pit, Car Top, and Machine Room. OEM/service provider or the building management should not object.</p>\n    \n        <p style="color: black;">3. Permission to carry Torch, Measuring tape, and other measuring instruments.</p>\n    \n        <p style="color: black;">4. Permission to record measurements and other findings as may be required.</p>\n    \n       <p style="color: black;">5. <u><b>Permission to carry a camera </b></u>and photograph the installation including the lobby, Elevator Pit, Elevator Machine fixing arrangements, Car top, floor landing fixtures, and any other space related to the equipment</p>\n    </div>\n    \n       <p style="color: black;">The Following Tools and measuring instruments with <u>Valid Calibration Certificates from NABL Accredited laboratories, traceable to national/international references </u>should be made available by the OEM/Service Provider throughout the inspection.</p>\n    <div style="padding-left: 20px;">\n       <table border="1" width="200" >\n        <tr >\n           <td style="text-align: center;color: black; font-weight:bold" >TOOLS</td>\n        </tr>\n        <tr>\n            <td style="text-align: center;color: black;">HANDLAMP</td>\n        </tr>\n        <tr>\n            <td style="text-align: center;color: black;">HAND TOOLS</td>\n        </tr>\n        <tr>\n            <td style="text-align: center;color: black;">DOOR OPEN KEYS</td>\n        </tr>\n    </table>\n    </div>\n    <br>\n    <p style="color: black;">\n        <b>This inspection shall be independent & impartial,</b> irrespective of any other engagement that PAPL Corp shall have with you. Please refer to our policy <a href="https://paplcorp.com/policy.html">(https://paplcorp.com/policy.html)</a> on the same for more information.\n    \n    Please email your feedback/ concerns/ complaints if any on the constitution of the inspector/s or any other issue about our engagement to <a href="info@paplcorp.com">info@paplcorp.com</a> the same shall be addressed on priority. Please refer to our policy on complaints and appeals <a href="https://paplcorp.com/policy-04.html">(https://paplcorp.com/policy-04.html)</a></p>\n    <div >\n    <p style="font-weight: bolder; color: black;">Note: This email is automatically generated by the system. Incase of Queries/clarifications, please do not hesitate to reach out to the PAPL team. Kindly confirm your availability by Clicking the \'Response\' button. </p>\n    </div>\n    \n    <br>\n    <br>\n    <div style="padding-left: 45%;"  >\n    \n    <br>\n    <a href=').concat(P,"?id=").concat(n,' target="_blank"> \x3c!-- Use mail_response here --\x3e\n        <button style="background-color: #3559E0; color: white; padding: 10px 20px; border-radius: 5px; "  >Response</button>\n    </a>\n    </div>\n    <br>\n    <br>\n    '),N=B.length>0?B.map((function(e,r){return{filename:"CV-attachment".concat(r+1,".pdf"),content:e.pdf.toString("base64"),encoding:"base64",contentType:"application/pdf"}})):[],O={from:R.user,to:E,cc:y,subject:"Elevators & Escalators Inspection,"+c,html:w,attachments:N},e.next=17,T.sendMail(O);case 17:return q=e.sent,console.log("Email sent report:",q.response),e.abrupt("return",t.json({success:q.response}));case 22:return e.prev=22,e.t0=e.catch(3),console.error("Error:",e.t0),console.error("Stack Trace:",e.t0.stack),e.abrupt("return",t.status(500).json({error:"Internal Server Error",message:e.t0.message,stack:e.t0.stack}));case 27:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(r,t){return e.apply(this,arguments)}}()),N.post("/api/Client_approval",(function(e,r){var t=e.body.id;console.log("Server called",t),C.query("UPDATE `inf_26` SET `client_approval_status` = ? WHERE `id` = ?",["1",t],(function(e,t){e?(console.error("Error:",e),r.status(500).json("Internal Server Error")):t.affectedRows>0?(console.error("Approved:"),r.status(200).json("Approved")):(console.error("Record not found:"),r.status(404).json("Record not found"))}))})),N.post("/api/submitRejection",(function(e,r){var t=e.body,o=t.data,n=t.id;console.log("Server called",n),C.query("UPDATE `inf_26` SET `client_rejection_reason` = ? WHERE `id` = ?",[o,n],(function(e,t){e?(console.error("Error:",e),r.status(500).json("Internal Server Error")):t.affectedRows>0?(console.error("Added:"),r.status(200).json("Added")):(console.error("Record not found:"),r.status(404).json("Record not found"))}))})),N.post("/api/Check_Client_response",(function(e,r){var t=e.body.id;console.log("Server called",t),C.query("SELECT `client_approval_status`, `client_rejection_reason` FROM `inf_26` WHERE `id`=?",[t],(function(e,t){e?(console.error("Error:",e),r.status(500).json("Internal Server Error")):(console.error("Added:"),r.status(200).json(t))}))})),N.post("/api/setMailstatus",(function(e,r){var t=e.body.id;console.log("Server called===",t),C.query("UPDATE `inf_26` SET`mailset_status`='1' WHERE id=?",[t],(function(e,t){t?r.json({message:"Mail status set successfully"}):r.json({message:"Mail status Not successfully"})}))})),N.get("/api/get_Rejection_schedule",(function(e,r){console.log("Server called *****&"),C.query("SELECT * FROM `reject_cause` WHERE 1",(function(e,t){t?(console.log(t),r.json(t)):r.json({message:"Mail status Not successfully"})}))})),N.get("/api/get_checklistmaster",(function(e,r){C.query("SELECT * FROM `inspection_master` WHERE 1",(function(e,t){return t?r.json(t):r.status(404).json({message:"No data found for the organization"})}))})),N.get("/api/getpitContent",(function(e,r){var t=e.query.product;console.log("PPP called",t),C.query("SELECT `Description` FROM `inspection_master` WHERE `Parts`= ?",[t],(function(e,t){t?(console.log(t),r.json(t)):(console.error(e),r.status(500).send("Error occurred"))}))})),N.get("/api/get_insp_master_checklist_description",(function(e,r){var t=e.query.Description;console.log("PPP called",t),C.query("SELECT   `Reference`, `Photo`, `Dropdown`,Negative_MNT,Negative_ADJ,Positive_ADJ,Positive_MNT,Emergency_Features,Customer_Scope,functional_point,Risklevel,id FROM `inspection_master` WHERE `Description`= ?",[t],(function(e,t){t?(console.log("/////",t),r.json(t)):(console.error(e),r.status(500).send("Error occurred"))}))})),N.get("/api/getUnitNumbers",(function(e,r){var t=e.query,o=t.contractNo,n=t.documentidForUrl;C.query("SELECT  unit_no FROM unit_details WHERE document_id=? AND contract_number=?",[n,o],(function(e,t){t&&C.query("SELECT Parts FROM inspection_master GROUP BY Parts ORDER BY MIN(id) ASC",(function(e,o){if(e)return console.error("Error fetching distinct Parts:",e),r.status(500).json({error:"Internal server error"});C.query("SELECT Description,Parts FROM inspection_master GROUP BY Description ORDER BY MIN(id) ASC",(function(e,n){return e?(console.error("Error fetching distinct Parts:",e),r.status(500).json({error:"Internal server error"})):(console.log("/////",n),r.json({unit:t,parts:o,descriptionParts:n}))}))}))}))})),N.post("/api/insert_Record_Values",T.single("image"),(function(e,r){var t=e.body,o=t.id_no,n=t.risk_level,s=t.functional_point,a=t.documentId,i=t.inspectorName,c=t.section,u=t.unitNo,l=t.title,d=t.valueArray,_=t.checkpoint,p=t.NeedforReport,f=t.positive_MNT,m=t.positive_ADJ,g=t.Negative_MNT,E=t.Negative_ADJ,y=t.Emergency_Features,v=t.Customerscope;console.log("id no is",o),console.log("value array is",d);var h=e.file,b=h?h.path:null,S=null,j=parseFloat(f),R=parseFloat(m),T="1"===y,w="1"===v,N="true"===_,O="true"===p;function q(){var e=[];e.push([o,n,s,a,i,u,l,d,N,S,O,c,j,R,g,E,T,w]),C.query("INSERT INTO record_values (id_no,risk_level,functional_point,document_id, inspector_name, unit_no, description, dropdown_option, checked, img, needforReport, section, Positive_MNT, Positive_ADJ, Negative_MNT, Negative_ADJ, Emergency_Features, Customer_Scope) VALUES ?",[e],(function(e,t){return e?(console.error("Error inserting into pit:",e),r.status(500).json({error:"An error occurred while inserting into database."})):t&&t.affectedRows>0?(b&&D.unlink(b,(function(e){e&&console.error("Error deleting image file:",e)})),r.json("Data Saved Successfully")):r.status(500).json({error:"No rows were inserted into the database."})}))}h&&(S=D.readFileSync(h.path)),console.log("document id is",a),console.log("section ",c),console.log("inspector name",i),console.log("unit no",u),console.log("title is ",l),console.log("value array",d),C.query("SELECT COUNT(*) AS count FROM record_values WHERE document_id = ? AND section = ? AND inspector_name = ? AND unit_no = ? AND description = ? AND dropdown_option = ?",[a,c,i,u,l,d],(function(e,t){if(e)return console.error("Error checking if record already exists:",e),r.status(500).json({error:"An error occurred while checking if record already exists."});var n=t[0].count;console.log("count is",n),n>0?C.query("DELETE FROM record_values WHERE id_no = ?",[o],(function(e,t){if(e)return console.error("Error deleting existing records:",e),r.status(500).json({error:"An error occurred while deleting existing records."});q()})):q()}))})),N.get("/api/get_getinspectionMaster_unique_for_quality",function(){var e=l(s().mark((function e(r,t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.query("SELECT  DISTINCT `Parts`,`id`, `Description`, `Dropdown` FROM `inspection_master` WHERE 1",(function(e,r){if(!e){var o=Y(r);return t.json(o)}console.error("Error fetching image from database:",e),t.status(500).json({error:"Internal Server Error"})}));case 2:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),N.post("/api/Check_check_data_exists",(function(e,r){var t=e.body,o=t.Doc,n=t.unit,a=t.section,i=t.insp_name,c=t.String_array.split("~"),u=[],d=function(e){return new Promise((function(r,t){C.query("\n        SELECT COUNT(*) AS count \n        FROM record_values \n        WHERE document_id=? AND unit_no=? AND section=? AND inspector_name=? AND description=?\n      ",e,(function(e,o){if(e)t(e);else{var n=o[0].count;r(n>0)}}))}))},_=c.map(function(){var e=l(s().mark((function e(r){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d([o,n,a,i,r]);case 2:t=e.sent,u.push(t);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());Promise.all(_).then((function(){console.log("response array ",u),r.json(u)})).catch((function(e){console.error("Error checking data existence:",e),r.status(500).json({error:"An error occurred while checking data existence."})}))})),N.get("/api/verify-email",(function(e,r){var t=e.query,o=t.email,n=t.token;x.query("SELECT Emailtoken FROM clientadmin WHERE Email= ?",[o],(function(e,t){return e?r.status(101).json("Email verification faild"):t[0].Emailtoken!==n?r.status(401).json("Invalid verification token"):void x.query("UPDATE `clientadmin` SET `Emailverified`=? WHERE Email=?",[1,o],(function(e,t){return t?r.send('\n            <html>\n            <body>\n              <h1>Email Verified Successfully</h1>\n              <p style="color: black;">All is set! You can now move to your dashboard.</p>\n              \x3c!-- You can add a button or link to navigate to the dashboard --\x3e\n              <a href="'.concat(process.env.CLIENT_URL,'">Go to Dashboard</a>\n            </body>\n            </html>\n          ')):e?r.status(401).json("Email verified Successfull"):void 0}))}))})),N.get("/api/ResendVerificationLink",(function(e,r){var t=e.query.Email,o=h();J(t,o,(function(e){e?r.json({success:!1,message:"Failed to send verification email"}):x.query("UPDATE clientadmin SET Emailtoken= ? WHERE Email=?",[o,t],(function(e,t){t&&(console.log("DB Updated"),r.json({success:!0,message:"Verification link sent successfully"}))}))}))})),N.get("/api/Get_Insp_List",(function(e,r){C.query("SELECT `inspector_list` FROM `inf_26` WHERE 1 ",(function(e,t){if(e)return r.status(500).json({error:"Internal server error"});var o=t.filter((function(e){return'[""]'!==e.inspector_list&&null!==e.inspector_list}));return console.log("---------\x3e",o),r.json(o)}))})),N.get("/api/leaveData",(function(e,r){var t=Firebase_db.ref("/Leave/Leaveforleadknown/krishnannarayananpaplcorpcom"),o=new Date,n=new Date;n.setMonth(o.getMonth()+2),t.once("value",(function(e){var t=e.val(),s={};Object.keys(t).forEach((function(e){var r=t[e];Object.keys(r).forEach((function(t){var a=r[t];Object.keys(a).forEach((function(r){var i=a[r];Object.keys(i).forEach((function(a){var i=new Date("".concat(t,"-").concat(r,"-").concat(a));if(i>=o&&i<=n){var c=i.toISOString().split("T")[0];s[c]||(s[c]={date:c,names:[]}),s[c].names.push(e)}}))}))}))}));var a=Object.values(s);r.json(a)}),(function(e){console.error("The read failed: "+e.code),r.status(500).send("Internal Server Error")}))})),N.post("/api/profileInsert",(function(e,r){var t=e.body,o=t.organization_name,n=t.address,s=t.pincode,a=t.state,i=t.country,c=t.contact,u=t.organization;x.query("INSERT INTO organization_profile(Organization_name,Address,Pincode,State,Country,Contact,Organization) VALUES (?,?,?,?,?,?,?)",[o,n,s,a,i,c,u],(function(e,t){e?r.json("Error"):t&&r.json("Profile is uploaded")}))})),N.get("/api/Email_exists",(function(e,r){var t=e.query.Email;console.log("server called",t),x.query("SELECT Email, Emailverified FROM clientadmin WHERE Email = ?",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.length>0?(console.log("Email exists:",t),r.json(t)):(console.log("Email does not exist"),r.json({error:"Email does not exist"}))}))})),N.get("/api/sent_Password_reset_link",function(){var e=l(s().mark((function e(r,t){var o,n,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.query.Email,e.prev=1,e.next=4,H();case 4:n=e.sent,a=v.createTransport({service:"gmail",auth:{user:n.user,pass:n.pass}}),i=b.v4(),x.query("UPDATE `clientadmin` SET `Emailtoken`= ? WHERE `Email`=?",[i,o],(function(e,r){if(r){var n=process.env.CLEINT_URL+"/reset?token=".concat(i);console.log(o,i);var s={from:"paplsoft.itservice@gmail.com",to:o,subject:"Password Reset Request",html:"\n            <p>Hello,</p>\n            <p>We received a request to reset your password. If you didn't make this request, please ignore this email.</p>\n            <p>Click the following link to reset your password:</p>\n            <a href=\"".concat(n,'">').concat(n,"</a>\n            <p>If the link doesn't work, copy and paste it into your browser's address bar.</p>\n            <p>Thank you!</p>\n          ")};a.sendMail(s,(function(e,r){e?(console.error("Error sending email:",e),t.status(500).json({error:"Error sending email"})):(console.log("Email sent:",r.response),t.status(200).json({success:"Reset link sent to your mail. Please check it."}))}))}else console.error("Error updating token in the database:",e),t.status(500).json({error:"Internal server error"})})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error retrieving transporter data:",e.t0),t.status(500).json({error:"Failed to retrieve transporter data"});case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(r,t){return e.apply(this,arguments)}}()),N.post("/api/Reset_Password",function(){var e=l(s().mark((function e(r,t){var o,n,a,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.body,n=o.Password,a=o.token,i=o.Email,e.prev=1,e.next=4,E.hash(n,12);case 4:c=e.sent,console.log("password",c),console.log("token",a),console.log("Email",i),x.query("UPDATE clientadmin SET Password = ? WHERE Email = ? AND Emailtoken = ?",[c,i,a],(function(e,r){return e?(console.error("Error updating password:",e),t.status(500).json({error:"Internal server error"})):r.affectedRows>0?(console.log("Password updated successfully"),x.query("UPDATE `clientadmin` SET `Emailtoken`=? WHERE `Email`=?",["Empty",i]),t.json({success:"Password updated successfully"})):(console.log("Email does not exist or token is invalid"),t.json({error:"Email does not exist or Link is expired"}))})),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),console.error("Error hashing password:",e.t0),e.abrupt("return",t.status(500).json({error:"Internal server error"}));case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(r,t){return e.apply(this,arguments)}}()),N.get("/api/loginData",(function(e,r){x.query("SELECT Email,Username,Organization,Status,Role,Emailverified,Department FROM clientadmin",(function(e,t){if(e)return r.status(500).json({error:e});var o=t.length;Logineddata=[];for(var n=0;n<o;n++)Logineddata[n]=t[n];r.json(Logineddata)}))})),N.delete("/api/Role_Data_Delete",(function(e,r){var t=e.body,o=t.organization,n=t.role;if(!o||!n)return r.status(400).json({error:"Organization and department are required in the request body"});x.query("DELETE FROM organization_role WHERE Organization=? AND Role=?",[o,n],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.delete("/api/Department_Data_Delete",(function(e,r){var t=e.body,o=t.organization,n=t.department;if(!o||!n)return r.status(400).json({error:"Organization and department are required in the request body"});x.query("DELETE FROM organization_department WHERE Organization=? AND Department=?",[o,n],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.delete("/api/adminregister_login_delete",(function(e,r){var t=e.body.email;x.query("DELETE FROM `clientadmin` WHERE `Email`= ? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):r.status(401).json({error:"Delete Successfully"})}))})),N.post("/api/login",(function(e,r){var t=e.body,o=t.username,n=t.password;x.query("SELECT Email,Password,Organization,Status,Role,Username,Emailverified FROM clientadmin WHERE Email = ?",[o],(function(e,t){if(e)return console.log(e),r.status(500).json({error:"Internal server error"});if(0===t.length)return r.status(401).json({error:"Invalid username or password"});var s=t[0];E.compare(n,s.Password,(function(t,n){if(t)return console.error("Bcrypt Compare Error:",e),r.status(500).json({error:"Internal server error"});if(!n)return r.status(401).json({error:"Invalid username or password"});try{var a=y.sign({userId:o},"mySecretKeyForJWTAuthentication",{expiresIn:"1h"}),i=s.Status,c=s.Role,u=s.Organization,l="sam",d=s.Emailverified;C.query("SELECT inspector_name FROM insp_data WHERE emailid= ?  ",o,(function(e,t){l=s.Username,r.json({token:a,status:i,role:c,organization:u,user_name:l,mail_status:d})}))}catch(e){r.status(500).json({error:"Token creation failed"})}}))}))})),N.get("/api/get_emp_data",(function(e,r){C.query("SELECT NAME,email_id,PSN_NO,designation,contact_no,date_of_joining,date_of_birth,dept FROM emp_data",(function(e,t){if(e)return console.log("Error accoured",e),r.status(500).json({error:e});var o=t.length;Logineddata=[];for(var n=0;n<o;n++)Logineddata[n]=t[n];console.log(Logineddata),r.json(Logineddata)}))})),N.put("/api/update_profile",(function(e,r){var t=e.body,o=t.name,n=t.email_id,s=t.PSN_NO,a=t.designation,i=t.contact_no,c=t.date_of_joining,u=t.date_of_birth,l=t.dept,d=t.existingemail;C.query("UPDATE emp_data SET NAME=? ,PSN_NO=?,designation=?,contact_no=?,email_id=?,date_of_joining=?,date_of_birth=?,dept=? WHERE email_id=? ",[o,s,a,i,n,c,u,l,d],(function(e,t){e?(console.log("Error",e),r.status(500).json({error:"internal server error"})):0===t.affectedRows?(console.log("Existing not found"),r.status(404).json({error:"Existing data nit found"})):(console.log("Update success"),r.json({message:"Updated success"}))})),N.post("/api/add_profile_data",(function(e,r){var t=e.body;x.query("INSERT INTO emp_data SET ?",t,(function(e,t){e?(console.error("MySQL insertion error:",e),r.status(500).json({error:"Error adding user"})):(console.log("User added to MySQL:",t),r.status(200).json({message:"User added successfully"}))}))}))})),N.delete("/api/delete_emp_data",(function(e,r){console.log("server called");var t=e.body.email_id;if(!t)return r.status(400).json({error:"Email ID is required"});C.query("DELETE FROM emp_data WHERE email_id=?",[t],(function(e,t){return e?(console.error(e),r.status(500).json({error:"Error deleting user"})):r.status(200).json({message:"User deleted successfully++++"})}))})),N.get("/api/inspectorCv",(function(e,r){C.query("SELECT PSN_NO FROM pdf_cv",(function(e,t){if(e)console.error(e),r.status(500).json({error:"Internal Server Error"});else{var o=t.map((function(e){return e.PSN_NO}));r.json({psnNumbers:o})}}))})),N.post("/api/inspector_cv_upload",T.single("pdf"),(function(e,r){var t=e.body.psn,o=e.file.buffer;if(!t||!o)return r.status(400).json({error:"Missing required parameters (psn or pdf)."});C.query("INSERT INTO pdf_cv(pdf, PSN_NO) VALUES (?, ?)",[o,t],(function(e,t){return e?"ER_DUP_ENTRY"===e.code?(console.log("ER_DUP_ENTRY"),r.status(400).json({error:"PSN_NO already exists."})):(console.error(e),r.status(500).json({error:"Internal Server Error"})):r.status(200).json({message:"Uploaded successfully"})}))})),N.put("/api/adminregister_login_update",(function(e,r){var t=e.body,o=t.email,n=t.organization,s=t.role,a=t.lstatus,i=t.authenticator,c=t.username,u=t.emailverified,l=t.existingmail,d=t.department,_=h();x.query("UPDATE clientadmin SET Email = ?, Organization = ?, Role = ?, Status = ?, Authenticator = ?, Username = ?, Emailverified = ?, Emailtoken = ?, Department=? WHERE Email = ?",[o,n,s,a,i,c,u,_,d,l],(function(e,r){e?e.errno:(W(userid,_),console.log("Verification token",_,o,r))}))})),N.post("/api/InsertRoleData",(function(e,r){var t=e.body,o=t.Role,n=t.Organization;x.query("INSERT INTO organization_role (Organization, Role) VALUES (?, ?)",[n,o],(function(e,t){e?1062===e.errno?r.status(400).json({message:" This data already exists."}):(console.error("Database Error:",e),r.status(500).json({message:"Internal Server Error"})):r.status(200).json({message:"Insert Successful"})}))})),N.post("/api/InsertDepartmentData",(function(e,r){var t=e.body,o=t.Department,n=t.Organization;x.query("INSERT INTO organization_department (Organization, Department) VALUES (?, ?)",[n,o],(function(e,t){e?1062===e.errno?r.status(400).json({message:" This data already exists."}):(console.error("Database Error:",e),r.status(500).json({message:"Internal Server Error"})):r.status(200).json({message:"Insert Successful"})}))})),N.post("/api/InsertRoleData",(function(e,r){var t=e.body,o=t.Role,n=t.Organization;x.query("INSERT INTO organization_role (Organization, Role) VALUES (?, ?)",[n,o],(function(e,t){e?(Console.log(e),1062===e.errno?r.status(400).json({message:" This data already exists."}):(console.error("Database Error:",e),r.status(500).json({message:"Internal Server Error"}))):(console.log("INsertjjjjjjjjjjjjjjjjj"),r.status(200).json({message:"Insert Successful"}))}))})),N.post("/api/adminregister",(function(e,r){var t=e.body,o=t.userid,n=t.password,s=t.organization,a=t.role,i=t.status,c=t.authenticator,u=t.name,l=t.statusnum,d=t.department,_=h();E.hash(n,12,(function(e,t){e?console.error("Bcrypt Hash Error:",e):x.query("INSERT INTO clientadmin (Email, Password, Organization, Role,Status,Authenticator,Username,Emailverified,Emailtoken,Department) VALUES (?, ?, ?, ?, ?,?,?,?,?,?)",[o,t,s,a,i,c,u,l,_,d],(function(e,t){e?1062==e.errno&&r.status(501).json({message:"Email Already exists"}):(r.status(200).json({message:"Data inserted successfully"}),W(o,_))}))}))})),N.get("/api/getRoleData",(function(e,r){var t=e.query.organization;x.query("SELECT d.Department AS Department, r.Role AS Role, d.Organization AS Organization FROM organization_department d INNER JOIN organization_role r ON d.Organization = r.Organization WHERE d.Organization = ? ",[t],(function(e,o){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});if(0===o.length)return console.error("No results found for organization:",t),r.status(401).json({error:"Invalid Organization Name"});for(var n=new Set,s=new Set,a=new Set,i=[],c=[],u=[],l=0;l<o.length;l++){var d=o[l];n.has(d.Department)||(i.push(d.Department),n.add(d.Department)),s.has(d.Role)||(c.push(d.Role),s.add(d.Role)),a.has(d.Organization)||(u.push(d.Organization),a.add(d.Organization))}var _={Department:i,Role:c,Organization:u};r.json(_)}))})),N.post("/api/upload",T.single("file"),(function(e,r){try{if(!e.file)return r.status(400).json({message:"No file uploaded"});var t=O.read(e.file.buffer,{type:"buffer"});if(console.log("server called"),1==t.SheetNames.length){var o=t.SheetNames[0],n=O.utils.sheet_to_json(t.Sheets[o]),s=Object.keys(n[0]),a=n.map((function(e){return Object.values(e)})),i=a[0].length;console.log("First Sub array",a[0]);for(var c,u=!1,l=1;l<a.length;l++)a[l].length!==i&&(u=!0,c=a[l][0]+" "+a[l][1]+" "+a[l][2]);if(u)r.json({message:"In the Excel file, certain cells are left unfilled. Please check this Row \n' "+c+"'"});else{for(var d,_,p,f,m,g=-1,E=-1,y=-1,v=-1,h=-1,b=-1,S=-1,j=-1,R=-1,T=-1,D=-1,w=-1,N=-1,q=0;q<s.length;q++)switch(s[q].trim().toLowerCase()){case"photo":case"photos":g=q;break;case"drop down":case"drop_down":case"drop _ down":case"dropdown":E=q;break;case"risk level":case"risk_level":case"risk _ level":case"risklevel":y=q;break;case"parts":case"part":h=q;break;case"product":case"products":v=q;break;case"reference":case"references":S=q;break;case"description":case"descriptions":b=q;break;case"positive mnt":case"positive_mnt":j=q;break;case"positive adj":case"positive_adj":R=q;break;case"negative mnt":case"negative_mnt":T=q;break;case"negative adj":case"negative_adj":D=q;break;case"emergency feature":case"emergency_feature":case"emergency features":case"emergency_features":w=q;break;case"customer scope":case"customer_scope":N=q}var k,L=!1,I="";if(console.log("index number",g,E,y,v,h,b,j,R,T,D,w,N),g>-1&&E>-1&&y>-1&&v>-1&&h>-1&&b>-1&&j>-1&&R>-1&&T>-1&&D>-1&&w>-1&&N>-1)for(var A=0;A<a.length;A++){var M=a[A][g].match(/~/g);d=M?M.length:0;var x=a[A][E].match(/~/g);_=x?x.length:0;var F=String(a[A][y]).match(/~/g);p=F?F.length:0;var P=String(a[A][T]).match(/~/g);f=P?P.length:0;var H=String(a[A][D]).match(/~/g);m=H?H.length:0,console.log("index value"),d===_&&_===p&&m==f&&m==_?(console.log("All R equal"),L=!0):(L=!1,d!==_&&d!==p?(I=" Photo ",k=A):_!==d&&_!==p?(I=" Dropdown ",k=A):p!==d&&p!==_?(I=" Risklevel ",k=A):m!==d&&m!==_?(I=" Negative ADJ ",k=A):f!==d&&f!==_&&(I=" Negative MNT",k=A))}else r.json({message:"The column title is not defined. "});if(L){console.log("insert area");for(var U="INSERT INTO `inspection_master`(`Product`, `Parts`, `Description`, `Reference`, `Risklevel`, `Photo`, `Dropdown`,`Positive_MNT`,`Positive_ADJ`,`Negative_MNT`,`Negative_ADJ`,`Emergency_Features`,`Customer_Scope`) VALUES ",W=0;W<a.length;W++){var J=a[W],V="Y"===J[w]||"yes"===J[w].toLowerCase()||1==J[w]?1:0,Q="Y"===J[N]||"yes"===J[N].toLowerCase()||1==J[N]?1:0;U+="('".concat(J[v],"', '").concat(J[h],"', '").concat(J[b],"', '").concat(J[S],"', '").concat(J[y],"', '").concat(J[g],"', '").concat(J[E],"','").concat(J[j],"','").concat(J[R],"','").concat(J[T],"','").concat(J[D],"','").concat(V,"','").concat(Q,"')"),W!==a.length-1&&(U+=", ")}C.query(U,(function(e,t){if(e)return console.error("Error executing SQL query:",e),r.status(500).json({error:"An error occurred while executing the database query.",details:e.message});r.json({message:"File merged into the database successfully."})}))}else console.log("Check some index missing "+k+" "+v+" "+k+" "+h+" "+k+b+" "+I+" "),r.json({message:"Check some index missing "+a[k][v]+" "+a[k][h]+" "+a[k][b]+" "+I+" "})}}else r.json({message:"I am currently experiencing difficulty processing multiple sheets in Excel (need 1 sheet at a time)."})}catch(e){console.error("Error processing file:",e),r.status(400).json({message:"Invalid file format"})}})),N.get("/api/check_connectivity",(function(e,r){r.json(!0)})),N.get("/api/getdefaultcc",(function(e,r){C.query("SELECT  mailid FROM default_cc WHERE 1",(function(e,t){null!=t&&r.json(t)}))})),N.post("/api/syncOff",T.single("image"),(function(e,r){var t=e.body,o=t.key,n=t.documentId,s=t.inspectorName,a=t.section,i=t.unitNo,c=t.title,u=t.valueArray,l=t.checkpoint,d=t.NeedforReport,_=t.positive_MNT,p=t.positive_ADJ,f=t.Negative_MNT,m=t.Negative_ADJ,g=t.Emergency_Features,E=t.Customerscope,y=t.id_no,v=t.risk_level,h=t.functional_point,b=e.file,S=(b&&b.path,null),j=parseFloat(_),R=parseFloat(p),T=parseFloat(f),w=parseFloat(m),N="1"===g,O="1"===E,q="true"===l,k="true"===d,L=[];b&&(S=D.readFileSync(b.path));var I=[n,s,i,c,u,q?1:0,S,k?1:0,a,j,R,T,w,N,O,y,v,h],A=new Promise((function(e,r){C.query("SELECT * FROM record_values WHERE document_id = ? AND section = ? AND inspector_name = ? AND unit_no = ? AND description = ? AND dropdown_option = ?",[n,a,s,i,c,u],(function(t,o){if(t)return r(t);0===o.length?C.query("INSERT INTO record_values (document_id, inspector_name, unit_no, description, dropdown_option, checked, img, needforReport, section, Positive_MNT, Positive_ADJ, Negative_MNT, Negative_ADJ, Emergency_Features, Customer_Scope,id_no,risk_level,functional_point) VALUES (?) ",[I],(function(t,o){if(t)return r(t);e("Data synchronization complete")})):e("Record already exists, skipping insertion.")}))}));L.push(A),Promise.all(L).then((function(e){console.log("result",e),r.json({message:e[0],key:o})})).catch((function(e){console.error("Error during record handling:",e),r.status(500).json({message:"Failed to synchronize data",error:e})}))})),N.get("/api/getUnit_details",(function(e,r){C.query("SELECT `document_id`, `contract_number`, `unit_no`, `inspector_name` ,`ReportComplete` FROM `unit_details` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("Unit Details",t),r.json(t)}))})),N.get("/api/getUnit_details",(function(e,r){C.query("SELECT `document_id`, `contract_number`, `unit_no`, `inspector_name` ,`ReportComplete` FROM `unit_details` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("Unit Details",t),r.json(t)}))})),N.get("/api/getChecklist_Record_Val_with_unit_checked",(function(e,r){var t=e.query,o=t.doc_id,n=t.unit_array.split(",");console.log("++++++++++++++++++"),console.log("parse val",n,o),C.query("SELECT  unit_no, description, dropdown_option, checked, img, needforReport, section FROM  record_values WHERE checked=? AND document_id = ?  AND unit_no IN (?)",[!0,o,n],(function(e,t){if(e)return console.error("Error fetching record values:",e),r.status(500).json({error:"Internal server error"});if(0===t.length)return r.status(404).json({error:"No record values found"});var o=t.map((function(e){if(null!=e.img&&e.checked){var r=e.img.toString("base64");return{unit_no:e.unit_no,description:e.description,dropdown_option:e.dropdown_option,checked:e.checked,img:r,needforReport:e.needforReport,section:e.section}}return e}));return r.json(o)}))})),N.get("/api/get_unique_description_with_section_api",(function(e,r){C.query("SELECT DISTINCT `description`,`Parts` FROM `inspection_master` WHERE 1",(function(e,t){if(e)console.error("Error fetching image from database:",e),r.status(500).json({error:"Internal Server Error"});else{if(0!==t.length){var n=function(e){return Object.entries(e).map((function(e){var r,t,n,s=a(e,2);return r={},t=s[0],n=s[1],(t=function(e){var r=function(e,r){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(r)?r:r+""}(t))in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}))}((s={},t.forEach((function(e){var r=e.Parts.trim().toLowerCase();s[r]||(s[r]=[]),s[r].push(e.description)})),s));return r.json(n)}r.status(404).json({error:" not found"})}var s}))})),N.post("/api/Check_check_data_exists",(function(e,r){var t=e.body,o=t.Doc,n=t.unit,a=t.section,i=t.insp_name,c=t.String_array,u=[],d=function(e){return new Promise((function(r,t){C.query("\n        SELECT COUNT(*) AS count \n        FROM record_values \n        WHERE document_id=? AND unit_no=? AND section=? AND inspector_name=? AND description=?\n      ",e,(function(e,o){if(e)t(e);else{var n=o[0].count;r(n>0)}}))}))},_=c.map(function(){var e=l(s().mark((function e(r){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d([o,n,a,i,r]);case 2:t=e.sent,u.push(t);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}());Promise.all(_).then((function(){r.json(u)})).catch((function(e){console.error("Error checking data existence:",e),r.status(500).json({error:"An error occurred while checking data existence."})}))})),N.get("/api/verify-email",(function(e,r){var t=e.query,o=t.email,n=t.token;x.query("SELECT Emailtoken FROM clientadmin WHERE Email= ?",[o],(function(e,t){return e?r.status(101).json("Email verification faild"):t[0].Emailtoken!==n?r.status(401).json("Invalid verification token"):void x.query("UPDATE `clientadmin` SET `Emailverified`=? WHERE Email=?",[1,o],(function(e,t){return t?r.send('\n            <html>\n            <body>\n              <h1>Email Verified Successfully</h1>\n              <p style="color: black;">All is set! You can now move to your dashboard.</p>\n              \x3c!-- You can add a button or link to navigate to the dashboard --\x3e\n              <a href="'.concat(process.env.CLIENT_URL,'">Go to Dashboard</a>\n                          </body>\n            </html>\n          ')):e?r.status(401).json("Email verified Successfull"):void 0}))}))})),N.get("/api/getDumpUsage",(function(e,r){C.query("SELECT usage_dumb FROM `dumb_usage` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});r.json(t)}))})),N.put("/api/addDump_Usage",(function(e,r){var t=e.body.dump_usage;console.log("Server called"),C.query("INSERT  INTO dumb_usage (usage_dumb) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/DumpUsage_Data_Delete",(function(e,r){var t=e.body.dumpusage;if(!t)return r.status(400).json({error:"Dump_Usage is required in the request body"});C.query("DELETE FROM dumb_usage WHERE usage_dumb=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/getDumpType",(function(e,r){C.query("SELECT type_dumb FROM `dumb_type` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addDump_Type",(function(e,r){var t=e.body.dump_type;console.log("Server called"),C.query("INSERT  INTO dumb_type (type_dumb) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/DumpType_Data_Delete",(function(e,r){var t=e.body.dumptype;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM dumb_type WHERE type_dumb=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/getHomeType",(function(e,r){C.query("SELECT home_type FROM `home_type` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addHome_Type",(function(e,r){var t=e.body.home_type;console.log("Server called"),C.query("INSERT  INTO home_type (home_type) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/HomeType_Data_Delete",(function(e,r){var t=e.body.hometype;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM home_type WHERE home_type=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/getHomeUsage",(function(e,r){C.query("SELECT home_usage FROM `home_usage` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addHome_Usage",(function(e,r){var t=e.body.home_usage;console.log("Server called"),C.query("INSERT  INTO home_usage (home_usage) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/HomeUsage_Data_Delete",(function(e,r){var t=e.body.homeusage;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM home_usage WHERE home_usage=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Ins_Time_Data",(function(e,r){C.query("SELECT time_shift FROM `inspection_time` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addIns_time",(function(e,r){var t=e.body.ins_time;console.log("Server called"),C.query("INSERT  INTO inspection_time (time_shift) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Ins_time_Data1",(function(e,r){var t=e.body.Ins_time;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM inspection_time WHERE time_shift=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Ins_Time_Insp_Data",(function(e,r){C.query("SELECT inspection_time FROM `inspection_time_ins` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/ins_time_insp",(function(e,r){var t=e.body.ins_time_insp;console.log("Server called"),C.query("INSERT  INTO inspection_time_ins (inspection_time) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Ins_time_insp_Data1",(function(e,r){var t=e.body.Ins_time_insp;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM inspection_time_ins WHERE inspection_time=? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_OEM_Data",(function(e,r){C.query("SELECT oem_name FROM `oem_details` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/oem_details",(function(e,r){var t=e.body.oem_details;console.log("Server called"),C.query("INSERT  INTO oem_details (oem_name) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_OEM_Data1",(function(e,r){var t=e.body.OEM;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM oem_details WHERE oem_name =? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Region_Details",(function(e,r){C.query("SELECT region_name FROM `region_details` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/region_details",(function(e,r){var t=e.body.region_details;console.log("Server called"),C.query("INSERT  INTO region_details (region_name) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Region_Data1",(function(e,r){var t=e.body.Region;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM region_details WHERE region_name =? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Travel_Acc_Details",(function(e,r){C.query("SELECT type_of FROM `travel_accomodation` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addToTravel_Acc_Details",(function(e,r){var t=e.body.Travel_Acc_details;console.log("Server called"),C.query("INSERT  INTO travel_accomodation (type_of) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Travel_Acc_Data1",(function(e,r){var t=e.body.Region;if(console.log("SErver********** ",t),!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM travel_accomodation WHERE type_of = ? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Type_Ele_Details",(function(e,r){C.query("SELECT type FROM `type_elevator` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addToType_EleDetails",(function(e,r){var t=e.body.Travel_Acc_details;console.log("Server called"),C.query("INSERT  INTO type_elevator (type) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Type_ele_Data1",(function(e,r){var t=e.body.Region;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM type_elevator WHERE type =? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/get_Type_Bul_Details",(function(e,r){C.query("SELECT building_name FROM `type_of_building` ",(function(e,t){if(e)return console.error("Error:",e),r.status(500).json({error:"Internal server error"});console.log("DUMP Type",t),r.json(t)}))})),N.put("/api/addToType_BulDetails",(function(e,r){var t=e.body.Travel_Acc_details;console.log("Server called"),C.query("INSERT  INTO type_of_building (building_name) VALUES (?)",[t],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(409).json({error:"Data already exists"}):r.json({message:"Data added successfully"})}))})),N.delete("/api/delete_Type_Bul_Data1",(function(e,r){var t=e.body.Region;if(!t)return r.status(400).json({error:"Value is required in the request body"});C.query("DELETE FROM type_of_building WHERE building_name =? ",[t],(function(e,t){return e?r.status(500).json({error:"Internal server error"}):t.affectedRows>0?r.json({message:"Delete Successful"}):r.status(404).json({error:"Data not found for deletion"})}))})),N.get("/api/building_type",(function(e,r){C.query("SELECT building_name FROM type_of_building",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.building_name}));r.json(o)}))})),N.get("/api/vendor",(function(e,r){C.query("SELECT VENDOR_NAME FROM vendor_master",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.VENDOR_NAME}));r.json(o)}))})),N.get("/api/region",(function(e,r){C.query("SELECT region_name FROM region_details",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.region_name}));r.json(o)}))})),N.get("/api/inspection_type",(function(e,r){C.query("SELECT inspection_name FROM inspection_type",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.inspection_name}));r.json(o)}))})),N.get("/api/oem",(function(e,r){C.query("SELECT oem_name FROM oem_details",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.oem_name}));r.json(o)}))})),N.get("/api/travel",(function(e,r){C.query("SELECT type_of FROM travel_accomodation",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.type_of}));r.json(o)}))})),N.get("/api/elevator_type",(function(e,r){C.query("SELECT type FROM type_elevator",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.type}));r.json(o)}))})),N.get("/api/elevator_usages",(function(e,r){C.query("SELECT e_usage FROM elevator_usage",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.e_usage}));r.json(o)}))})),N.get("/api/home_type",(function(e,r){C.query("SELECT home_type FROM home_type",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.home_type}));r.json(o)}))})),N.get("/api/home_usages",(function(e,r){C.query("SELECT home_usage FROM home_usage",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.home_usage}));r.json(o)}))})),N.get("/api/dumb_type",(function(e,r){C.query("SELECT type_dumb FROM dumb_type",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.type_dumb}));r.json(o)}))})),N.get("/api/rejection",(function(e,r){C.query("SELECT reject FROM rejects",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.reject}));r.json(o)}))})),N.get("/api/dumb_usages",(function(e,r){C.query("SELECT usage_dumb FROM dumb_usage",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.usage_dumb}));r.json(o)}))})),N.get("/api/fetch_section",(function(e,r){C.query("SELECT section_value FROM section",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.section_value}));r.json(o)}))})),N.get("/api/fetch_units",(function(e,r){var t=e.query.encodedValue,o="SELECT unit_no FROM unit_details WHERE document_id='".concat(t,"'");C.query(o,(function(e,t){if(e)console.error("Error storing values:",e),r.status(500).json({error:"Error storing values"});else{console.log("success:",t);var o=t.map((function(e){return e.unit_no}));r.status(200).json(o)}}))})),N.get("/api/fetch_units_r",(function(e,r){var t=e.query.encodedValue,o="SELECT report_array FROM unit_details WHERE document_id='".concat(t,"'");C.query(o,(function(e,t){if(e)console.error("Error fetching report array:",e),r.status(500).json({error:"Error fetching report array"});else{console.log("Success:",t);var o=[];t.length>0&&t[0].report_array&&(o=JSON.parse(t[0].report_array)),r.status(200).json(o)}}))})),N.get("/api/inspector",(function(e,r){var t=e.query.encodedValue,o="SELECT location, oem_details FROM inf_26 WHERE contract_number = '".concat(t,"'");C.query(o,(function(e,t){if(e)console.error(e),r.status(500).json({error:"Internal Server Error (First Query)"});else{var o=t[0].location,n=t[0].oem_details,s='SELECT inspector_name, PSN,PAPL_DOJ FROM insp_data WHERE (previous_employment = "'.concat(n,'" AND location_previousemp = "').concat(o,'" AND DATE_ADD(PAPL_DOJ, INTERVAL 2 YEAR) <= NOW()) OR (previous_employment != "').concat(n,'" OR location_previousemp != "').concat(o,'"); ');C.query(s,(function(e,t){if(e)console.error(e),r.status(500).json({error:"Internal Server Error (Second Query)"});else{var o=t.map((function(e){return e.inspector_name+" - "+e.PSN}));r.json(o)}}))}}))})),N.get("/api/inspection_time",(function(e,r){C.query("SELECT time_shift FROM inspection_time",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.time_shift}));r.json(o)}))})),N.get("/api/inspection_time_ins",(function(e,r){C.query("SELECT inspection_time FROM inspection_time_ins",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.inspection_time}));r.json(o)}))})),N.get("/api/inspector_type",(function(e,r){C.query("SELECT inspector_type FROM inspector_type",(function(e,t){if(e)return console.error("Error fetching values from MySQL:",e),void r.status(500).json({error:"Internal Server Error"});var o=t.map((function(e){return e.inspector_type}));r.json(o)}))})),N.get("/signature/:inspectorName",(function(e,r){var t=e.params.inspectorName;C.query("SELECT signature FROM signature WHERE inspector_name = ?",[t],(function(e,t){e?(console.error("Error fetching signature:",e),r.status(500).json({error:"Internal Server Error"})):t.length>0?(r.writeHead(200,{"Content-Type":"image/jpeg"}),r.end(t[0].signature,"binary")):r.status(404).json({error:"Signature not found"})}))})),N.post("/api/breif_spec_add",(function(e,r){console.log("breif spec called");var t=e.body,o=t.service_provider,n=t.no_of_machine_room,s=t.machine_room,a=t.type_of_motor,i=t.cabin_depth,c=t.capacity,u=t.speed,l=t.maintained_by,d=t.manual_rescue,_=t.document_id,p=t.unit_no,f=t.inspector_name,m=t.oem,g=t.elevator_number,E=t.type_of_equipment,y=t.year_of_manufacture,v=t.type_of_usage,h=t.machine_location,b=t.controller_drive_type,S=t.controller_name_as_per_oem,j=t.type_of_operation,R=t.grouping_type,T=t.name_of_the_group,D=t.floor_details,w=t.openings,N=t.floor_designations,O=t.front_opening_floors,q=t.rear_opening_floors,k=t.non_stop_service_floors,L=t.emergency_stop_floors,I=t.rope_category,A=t.no_of_ropes_belts,M=t.rope_size,x=t.no_of_drive_sheave_grooves,F=t.ropes_wrap_details,P=t.type_of_roping,H=t.machine_type,U=t.kilo_watt,W=t.voltage,J=t.current_in_ampere,V=t.frequency,Q=t.rpm,B=t.insulation_class,z=t.ingress_protection,G=t.no_of_poles,Y=t.st_hr,K=t.serial_no,Z=t.rope_dia,X=t.normal_speed,$=t.electrical_tripping_speed,ee=t.mechanical_tripping_speed,re=t.cwt_governor_details,te=t.door_operator,oe=t.cwt_rope_dia,ne=t.cwt_normal_speed,se=t.cwt_electrical_tripping_speed,ae=t.cwt_mechanical_tripping_speed,ie=t.entrance_width,ce=t.entrance_height,ue=t.type_of_openings,le=t.cabin_width,de=t.cabin_height,_e=t.no_of_car_operating_panels,pe=t.car_indicator_type,fe=t.multimedia_display,me=t.no_cabin_fans,ge=t.type_of_cabin_fan,Ee=t.type_of_call_buttons,ye=t.stop_button,ve=t.service_cabinet,he=t.voice_announcement,be=t.handrail,Se=t.cabin_bumper,je=t.auto_attendant,Re=t.auto_independant,Te=t.non_stop,De=t.fan_switch,we=t.hall_indicator_type,Ne=t.hall_laterns,Oe=t.arrival_chime,qe=t.no_of_risers_at_main_lobby,ke=t.no_of_risers_at_other_floors,Le=t.hall_call_type_at_main_lobby,Ie=t.hall_call_type_at_all_floors,Ae=t.no_of_car_buffers,Me=t.type_of_car_buffers,xe=t.no_of_cwt_buffer,Ce=t.type_of_cwt_buffer,Fe=t.e_light,Pe=t.e_alarm,He=t.e_intercom,Ue=t.ard_operation,We=t.ard_audio,Je=t.ard_visuals,Ve=t.fireman_operation,Qe=t.fireman_emerg_return,Be=t.fireman_audio,ze=t.fireman_visual,Ge=t.passenger_overload_operation,Ye=t.passenger_overload_visual,Ke=t.passenger_overload_audio,Ze=t.seismic_sensor_operation;function Xe(){C.query("INSERT INTO breif_spec(service_provider,no_of_machine_room,machine_room,type_of_motor,cabin_depth,capacity,speed,document_id,unit_no,inspector_name,oem,elevator_number,year_of_manufacture,machine_location,controller_driver_type,controller_name_as_per_oem,type_of_equipment,type_of_usage,type_of_operation,grouping_type,name_of_the_group,floor_stops,floor_opening,floor_designation,front_opening_floors,rear_opening_floors,service_floors,emergency_stop_floors,rope_category,number_of_rope_belt,rope_size,no_of_drive_sheave_grooves,ropes_wrap_details,type_of_roping,machine_type,motor_kilo_watt,motor_voltage,motor_current_in_ampere,motor_frequency,motor_rpm,motor_insulation_class,motor_ingress_protection,motor_no_of_poles,motor_st_hr,motor_serial_number,car_governor_rope_dia,car_governor_normal_speed,car_governor_electric_tripping_speed,car_governor_mechanical_tripping_speed,cwt_governor,cwt_governor_rope_dia,cwt_governor_normal_speed,cwt_governor_electrical_tripping_speed,cwt_governor_mechanical_tripping_speed,door_operator,entrance_height,entrance_width,entrance_type_of_opening,cabin_height,cabin_width,no_of_cop,car_indicator_type,multimedia_display,no_of_cabin_fans,type_of_cabin_fans,type_of_call_buttons,car_stop_button,car_service_cabinet,car_voice_announcement,car_handrail,car_cabin_bumper,car_auto_attendant,car_auto_independent,car_non_stop,car_fan_switch,hall_indicator_type,hall_lantems,hall_arrival_chime,no_of_risers_at_main_lobby,no_of_risers_at_other_floors,hall_call_type_at_main_lobby,hall_call_type_at_all_floors,no_of_car_buffers,type_of_car_buffers,no_of_counter_weight_buffer,type_of_cwt_buffer,e_light,e_alarm,e_intercom,ard_operation,ard_audio,ard_visual,fireman_operation,fer,fireman_audio,fireman_visual,manual_rescue,passenger_overload_operation,passenger_overload_visual,passenger_overload_audio,seismic_sensor_operation,maintained_by) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)",[o,n,s,a,i,c,u,_,p,f,m,g,y,h,b,S,E,v,j,R,T,D,w,N,O,q,k,L,I,A,M,x,F,P,H,U,W,J,V,Q,B,z,G,Y,K,Z,X,$,ee,re,te,oe,ne,se,ae,ie,ce,ue,le,de,_e,pe,fe,me,ge,Ee,ye,ve,he,be,Se,je,Re,Te,De,we,Ne,Oe,qe,ke,Le,Ie,Ae,Me,xe,Ce,Fe,Pe,He,Ue,We,Je,Ve,Qe,Be,ze,d,Ge,Ye,Ke,Ze,l],(function(e,t){if(e)return console.error("Error inserting new record:",e),r.status(500).json(e);console.log("Record inserted successfully:",t),r.status(200).json({message:"Data stored successfully"})}))}C.query("SELECT * FROM breif_spec WHERE document_id = ? AND unit_no = ?",[_,p],(function(e,t){if(e)return console.error("Error checking existing records:",e),r.status(500).json(e);t.length>0?C.query("DELETE FROM breif_spec WHERE document_id = ? AND unit_no = ?",[_,p],(function(e,t){if(e)return console.error("Error deleting existing record:",e),r.status(500).json(e);Xe()})):Xe()}))})),N.get("/api/check_record_exists",(function(e,r){var t=e.query,o=t.document_id,n=t.unit_no;C.query("SELECT * FROM breif_spec WHERE document_id = ? AND unit_no = ?",[o,n],(function(e,t){if(e)return console.error("Error checking record existence:",e),r.status(500).json({error:"Database query failed"});r.json(t.length>0)}))})),N.get("/api/check_connectivity",(function(e,r){r.json(!0)})),N.post("/generate-pdf",(function(e,r){var t=e.body.html;pdf.create(t).toBuffer((function(e,t){if(e)return console.error("Error generating PDF:",e),r.status(500).send("Error generating PDF");var o;o=t.toString("base64"),connection.query("INSERT INTO certificates (pdf_data) VALUES (?)",[o],(function(e,r){e?console.error("Error saving PDF to database:",e):console.log("PDF saved to database with ID:",r.insertId)})),r.status(200).send("PDF generated and saved to database")}))})),N.post("/api/store_data",(function(e,r){var t=e.body,o=t.contractNumber,n=t.region,s=t.location,a=t.checked_count,i=t.checked_items,c=t.unchecked_count,u=t.unchecked_items,l=t.total_items,d=t.elevator_values,_=t.home,p=t.dump,f=t.pincode,m=t.master_customer,g=t.work_order_no,E=t.customer_name_workorder,y=t.project_name,v=t.building_name,h=t.building_type,b=t.inspection_type_sync,S=t.site_address,j=t.customer_contact_name,R=t.customer_contact_number,T=t.customer_contact_mailid,D=t.total_number_of_units,w=t.no_of_elevator,N=t.no_of_stops_elevator,O=t.no_of_escalator,q=t.no_of_travelator,k=t.no_of_mw,L=t.no_of_dw,I=t.no_of_stops_dw,A=t.no_of_home_elevator,M=t.no_of_stops_home_elevator,x=t.no_of_car_parking,F=t.travel_expenses_by,P=t.accomodation_by,H=t.no_of_visits_as_per_work_order,U=t.no_of_mandays_as_per_work_order,W=t.total_units_schedule,J=t.balance_to_inspect,V=t.inspection_time,Q=t.inspector_name,B=t.tpt6,z=t.tpt7,G=t.load_test,Y=t.pmt,K=t.rope_condition,Z=t.client_whatsapp_number,X=t.inspection_time_ins,$=t.schedule_from,ee=t.schedule_to,re=t.customer_workorder_date,te=t.oem_details;C.query("INSERT INTO inf_26 (contract_number,region,location,checked_count,checked_items,unchecked_count,unchecked_items,total_items,elevator_values,home_elevator_values,dump_values,pincode,master_customer_name,customer_workorder_name,customer_name_as_per_work_order, project_name ,building_name,type_of_building,\ttype_of_inspection ,site_address, customer_contact_name,customer_contact_number,customer_contact_mailid ,total_number_of_units,no_of_elevator,no_of_stops_elevator,no_of_escalator,no_of_travelator,no_of_mw,no_of_dw,no_of_stops_dw ,no_of_home_elevator,no_of_stops_home_elevator,no_of_car_parking,travel_expenses_by,accomodation_by,\tno_of_visits_as_per_work_order,no_of_mandays_as_per_work_order,total_units_schedule,balance_to_inspect,inspection_time,inspector_name,tpt6,tpt7,load_test,pmt,rope_condition,client_whatsapp_number,inspection_time_ins,schedule_from,schedule_to,customer_workorder_date,oem_details) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);",[o,n,s,a,JSON.stringify(i),c,JSON.stringify(u),JSON.stringify(l),JSON.stringify(d),JSON.stringify(_),JSON.stringify(p),f,m,g,E,y,v,h,b,S,j,R,T,D,w,N,O,q,k,L,I,A,M,x,F,P,H,U,W,J,V,Q,B,z,G,Y,K,Z,X,$,ee,re,te],(function(e,t){e?(console.error("Error storeing values:",e),r.status(500).json({error:"Error storing values"})):(console.log("success:",t),r.status(200).json({message:"data stored successfully successfully"}))}))})),N.post("/api/store_data1",(function(e,r){var t=e.body,o=t.contractNumber,n=t.region,s=t.location,a=(t.checked_count,t.checked_items,t.unchecked_count,t.unchecked_items,t.total_items,t.elevator_values),i=t.home,c=t.dump,u=t.pincode,l=t.master_customer,d=t.work_order_no,_=t.customer_name_workorder,p=t.project_name,f=t.building_name,m=t.building_type,g=t.inspection_type_sync,E=t.site_address,y=t.customer_contact_name,v=t.customer_contact_number,h=t.customer_contact_mailid,b=t.total_number_of_units,S=t.no_of_elevator,j=t.no_of_stops_elevator,R=t.no_of_escalator,T=t.no_of_travelator,D=t.no_of_mw,w=t.no_of_dw,N=t.no_of_stops_dw,O=t.no_of_home_elevator,q=t.no_of_stops_home_elevator,k=t.no_of_car_parking,L=t.travel_expenses_by,I=t.accomodation_by,A=t.no_of_visits_as_per_work_order,M=t.no_of_mandays_as_per_work_order,x=(t.total_units_schedule,t.balance_to_inspect,t.inspection_time),F=(t.inspector_name,t.tpt6),P=t.tpt7,H=t.load_test,U=t.pmt,W=t.rope_condition,J=t.callback,V=t.balance,Q=t.client_whatsapp_number,B=(t.inspection_time_ins,t.schedule_from,t.schedule_to,t.customer_workorder_date),z=t.oem_details,G=t.car_parking_values,Y=t.escalator_values,K=t.mw_values,Z=t.travelator_values,X=t.job_type;C.query("INSERT INTO inf_26 (contract_number, region, location, elevator_values, home_elevator_values, dump_values, pincode, master_customer_name, customer_workorder_name, customer_name_as_per_work_order, project_name ,building_name, type_of_building,\ttype_of_inspection ,site_address, customer_contact_name, customer_contact_number,customer_contact_mailid ,total_number_of_units,no_of_elevator,no_of_stops_elevator, no_of_escalator, no_of_travelator, no_of_mw ,no_of_dw, no_of_stops_dw ,no_of_home_elevator, no_of_stops_home_elevator,no_of_car_parking,travel_expenses_by,accomodation_by,\tno_of_visits_as_per_work_order,no_of_mandays_as_per_work_order,inspection_time,tpt6,tpt7,load_test,pmt,rope_condition,callback,balance,client_whatsapp_number,customer_workorder_date,oem_details,car_parking_values,escalator_values,mw_values,travelator_values,job_type) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);",[o,n,s,JSON.stringify(a),JSON.stringify(i),JSON.stringify(c),u,l,d,_,p,f,m,g,E,y,v,h,b,S,j,R,T,D,w,N,O,q,k,L,I,A,M,x,F,P,H,U,W,J,V,Q,B,z,JSON.stringify(G),JSON.stringify(Y),JSON.stringify(K),JSON.stringify(Z),X],(function(e,t){e?(console.error("Error storeing values:",e),r.status(500).json({error:"Error storing values"})):(console.log("success:",t),r.status(200).json({message:"data stored successfully successfully"}))}))})),N.put("/api/store_data11",(function(e,r){var t=e.body,o=t.unit_values,n=(t.insp_name,t.contract_number,t.document_id),s=t.building_name;C.query("UPDATE unit_details SET unit_no=?,building_name=? WHERE document_id=?",[JSON.stringify(o),s,n],(function(e,t){e?(console.error("Error storeing values:",e),r.status(500).json({error:"Error storing values"})):(console.log("success:",t.insertId),r.status(200).json("success"))}))})),N.get("/api/pending",(function(e,r){var t=e.query.encodedValue;console.log("inspector name is",t);var o="SELECT * FROM unit_details where inspector_name='".concat(t,"'");C.query(o,(function(e,t){e?r.status(500).json({error:"Error fetching unit details from database"}):r.json(t)}))})),N.get("/api/approval",(function(e,r){C.query("SELECT * FROM report_files where report_status=? and reject=?",[0,0],(function(e,t){e?r.status(500).json({error:"Error fetching unit details from database"}):r.json(t)}))})),N.put("/api/update_reject_reason",(function(e,r){var t=e.body,o=t.documentId,n=t.unitName,s=t.rejectReason;C.query("UPDATE report_files SET rejected_reason = ?,reject=? WHERE document_id = ? AND unit_name = ?",[s,1,o,n],(function(e,t){e?(console.error("Error updating reject reason:",e),r.status(500).json({error:"Error updating reject reason"})):(console.log("Reject reason updated successfully"),r.status(200).json({success:!0}))}))})),N.put("/api/approve_report",(function(e,r){var t=e.body,o=t.documentId,n=t.unitName;C.query("UPDATE report_files SET report_status = 1 WHERE document_id = ? AND unit_name = ?",[o,n],(function(e,t){e?(console.error("Error approving report:",e),r.status(500).json({error:"Error approving report"})):(console.log("Report approved successfully"),r.status(200).json({success:!0}))}))})),N.get("/api/b_spec",(function(e,r){var t=e.query.encodedValue,o=e.query.encodedValue1,n="SELECT * FROM breif_spec where document_id='".concat(t,"' and unit_no='").concat(o,"'");C.query(n,(function(e,t){e?r.status(500).json({error:"Error fetching unit details from database"}):r.json(t)}))})),N.get("/api/b_spec_unit",(function(e,r){var t=e.query.encodedValue,o="SELECT * FROM unit_details where document_id='".concat(t,"'");C.query(o,(function(e,t){e?r.status(500).json({error:"Error fetching unit details from database"}):r.json(t)}))})),N.post("/api/store_data_agreement",(function(e,r){var t=e.body,o=t.check,n=t.name,s=t.contract_no,a=t.selfAssigned,i=t.salesProcess,c=t.head;C.query("INSERT INTO unit_details(contract_number,checks,inspector_name,selfAssigned,salesProcess,head) VALUES (?,?,?,?,?,?)",[s,o,n,a,i,c],(function(e,t){e?(console.error("Error storeing values:",e),r.status(500).json({error:"Error storing values"})):(console.log("success:",t.insertId),r.status(200).json(t.insertId))}))})),N.get("/api/risk-assessments",(function(e,r){C.query("SELECT id,description, remarks FROM site_risk_assessment",(function(e,t){if(e)return console.error("Error fetching data from MySQL: ",e),void r.status(500).json({error:"Error fetching data from MySQL"});r.json(t)}))})),N.post("/api/store_data2",(function(e,r){var t=e.body,o=t.contractNumber,n=t.region,s=t.location,a=(t.checked_count,t.checked_items,t.unchecked_count,t.unchecked_items,t.total_items,t.elevator_values,t.home,t.dump,t.pincode),i=t.master_customer,c=t.work_order_no,u=t.customer_name_workorder,l=t.project_name,d=t.building_name,_=t.building_type,p=t.inspection_type_sync,f=t.site_address,m=t.customer_contact_name,g=t.customer_contact_number,E=t.customer_contact_mailid,y=(t.total_number_of_units,t.no_of_elevator,t.no_of_stops_elevator,t.no_of_escalator,t.no_of_travelator,t.no_of_mw,t.no_of_dw,t.no_of_stops_dw,t.no_of_home_elevator,t.no_of_stops_home_elevator,t.no_of_car_parking,t.travel_expenses_by),v=t.accomodation_by,h=t.no_of_visits_as_per_work_order,b=t.no_of_mandays_as_per_work_order,S=(t.total_units_schedule,t.balance_to_inspect,t.inspection_time),j=(t.inspector_name,t.tpt6),R=t.tpt7,T=t.load_test,D=t.pmt,w=t.rope_condition,N=t.callback,O=t.balance,q=t.client_whatsapp_number,k=(t.inspection_time_ins,t.schedule_from,t.schedule_to,t.customer_workorder_date),L=(t.oem_details,t.car_parking_values,t.escalator_values,t.mw_values,t.travelator_values,t.job_type);C.query("INSERT INTO inf_26 (contract_number, region, location, pincode, master_customer_name, customer_workorder_name, customer_name_as_per_work_order, project_name ,building_name, type_of_building,\ttype_of_inspection ,site_address, customer_contact_name, customer_contact_number,customer_contact_mailid ,travel_expenses_by,accomodation_by,\tno_of_visits_as_per_work_order,no_of_mandays_as_per_work_order,inspection_time,tpt6,tpt7,load_test,pmt,rope_condition,callback,balance,client_whatsapp_number,customer_workorder_date,job_type) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);",[o,n,s,a,i,c,u,l,d,_,p,f,m,g,E,y,v,h,b,S,j,R,T,D,w,N,O,q,k,L],(function(e,t){e?(console.error("Error storeing values:",e),r.status(500).json({error:"Error storing values"})):(console.log("success:",t),r.status(200).json({message:"data stored successfully successfully"}))}))})),N.put("/api/update_data",(function(e,r){var t=e.body,o=t.contractNumber,n=t.checked_count,s=t.checked_items,a=t.unchecked_count,i=t.unchecked_items,c=t.total_items,u=t.schedule_from,l=t.schedule_to,d=t.inspector_name,_=t.inspection_time_ins,p=t.total_units_schedule,f=t.balance_to_inspect,m=t.i_status,g=t.no_of_breakdays,E=t.inspector_array;C.query("UPDATE inf_26 SET checked_count = ?, checked_items=?, unchecked_count=?, unchecked_items=?,\ttotal_items=?, inspection_time_ins=?, total_units_schedule=?, balance_to_inspect=?, schedule_from=?,schedule_to=?, inspector_list=? ,i_status=?, no_of_breakdays=?, inspector_array=? WHERE contract_number = ?",[n,JSON.stringify(s),a,JSON.stringify(i),JSON.stringify(c),_,p,f,u,l,JSON.stringify(d),m,g,JSON.stringify(E),o],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:"Name not found"}):r.json({message:"Email updated successfully"})}))})),N.put("/api/update_data_w",(function(e,r){var t=e.body,o=t.witness_details,n=t.document_id;C.query("UPDATE unit_details SET witness_details=? WHERE document_id=?",[JSON.stringify(o),n],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:" not found"}):r.json({message:"witness updated successfully"})}))})),N.put("/api/update_data_close",(function(e,r){var t=e.body,o=t.witness_details,n=t.document_id;C.query("UPDATE unit_details SET closing_meeting=?,closing_flag=? WHERE document_id=?",[JSON.stringify(o),1,n],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:" not found"}):r.json({message:"witness updated successfully"})}))})),N.put("/api/update_data_feedback",(function(e,r){var t=e.body,o=t.rating,n=t.customer_details,s=t.options,a=t.document_id;C.query("UPDATE unit_details SET rating=?,customer_details=?,options=?,feed_back=? WHERE document_id=?",[JSON.stringify(o),JSON.stringify(n),JSON.stringify(s),1,a],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:" not found"}):r.json({message:"witness updated successfully"})}))})),N.put("/api/update_data_s",(function(e,r){var t=e.body,o=t.risk,n=t.document_id;C.query("UPDATE unit_details SET risk=? WHERE document_id=?",[JSON.stringify(o),n],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:" not found"}):r.json({message:"site risk updated successfully"})}))})),N.post("/api/update-inf-26",(function(e,r){var t=e.body,o=t.contractNumber,n=t.differenceInDays;if(!o||void 0===n)return r.status(400).json({error:"Contract number or difference in days is missing."});C.query("UPDATE inf_26 SET difference_in_days = ? WHERE contract_number = ?",[n,o],(function(e,t){return e?(console.error("Error updating difference_in_days:",e),r.status(500).json({error:"Internal server error"})):(console.log("Difference_in_days updated successfully"),r.status(200).json({message:"Difference_in_days updated successfully"}))}))})),N.put("/api/update_data1",(function(e,r){var t=e.body,o=t.contractNumber,n=t.elevator_values,s=t.home,a=t.dump,i=t.oem_details,c=t.total_number_of_units,u=t.no_of_elevator,l=t.no_of_stops_elevator,d=t.no_of_escalator,_=t.no_of_travelator,p=t.no_of_mw,f=t.no_of_dw,m=t.no_of_stops_dw,g=t.no_of_home_elevator,E=t.no_of_stops_home_elevator,y=t.no_of_car_parking,v=t.car_parking_values,h=t.escalator_values,b=t.mw_values,S=t.travelator_values,j=t.status;C.query("UPDATE inf_26 SET \toem_details = ?,total_number_of_units=?, no_of_elevator=?, no_of_stops_elevator=?, no_of_escalator=?, no_of_travelator=?, no_of_mw=?, no_of_dw=?, no_of_stops_dw=?, no_of_home_elevator=?, no_of_stops_home_elevator=?, no_of_car_parking=?,elevator_values=?, home_elevator_values=?, travelator_values=?, dump_values=?, car_parking_values=?,escalator_values=?, mw_values=?,status=? WHERE contract_number = ?",[i,c,u,l,d,_,p,f,m,g,E,y,JSON.stringify(n),JSON.stringify(s),JSON.stringify(S),JSON.stringify(a),JSON.stringify(v),JSON.stringify(h),JSON.stringify(b),j,o],(function(e,t){e?(console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:"Name not found"}):r.json({message:"Email updated successfully"})}))})),N.get("/contract_no",(function(e,r){C.query("SELECT contract_number  FROM inf_26 WHERE i_status = 0 AND (    (job_type = 'V' AND status = '1')    OR job_type <> 'V');",(function(e,t){if(e)console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"});else{var o=t.map((function(e){return e.contract_number}));r.json(o)}}))})),N.get("/contract_no1",(function(e,r){C.query('SELECT contract_number FROM inf_26 where job_type="V" and status=0',(function(e,t){if(e)console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"});else{var o=t.map((function(e){return e.contract_number}));r.json(o)}}))})),N.get("/details/:c_no",(function(e,r){var t=e.params.c_no;C.query("SELECT * FROM inf_26 WHERE contract_number = ?",[t],(function(e,t){if(e)console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"});else if(0===t.length)console.log(e),r.status(404).json({error:"Name not found"});else{var o=t[0];r.json(o)}}))})),N.get("/api/job_type",(function(e,r){C.query("SELECT job_type FROM job_type",(function(e,t){if(e)console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"});else{var o=t.map((function(e){return e.job_type}));r.json(o)}}))})),N.get("/api/countRecords",(function(e,r){var t=e.query.name;console.log(t);var o="SELECT COUNT(*) AS count FROM inf_26 WHERE JSON_CONTAINS(inspector_array, ".concat(C.escape('{"name": "'.concat(t,'", "i_approved": 0,"i_rejected":0}')),")");C.query(o,(function(e,t){if(e)r.status(500).json({error:"Error fetching record count"});else{var o=t[0].count;console.log(o),r.status(200).json(o)}}))})),N.get("/api/breif_spec_fetch",(function(e,r){var t=e.query,o=t.unit_no,n=t.document_id;console.log("api",o),console.log("document_id",n),C.query("SELECT * FROM breif_spec WHERE unit_no = ? and document_id=?",[o,n],(function(e,t){if(e)console.error("Error executing SQL query:",e),r.status(500).json({error:"Internal Server Error"});else if(0===t.length)console.log(e),r.status(404).json({error:"Name not found"});else{var o=t[0];r.json(o)}}))})),N.get("/api/countRecords_u",(function(e,r){var t=e.query,o=t.name,n=t.id;console.log("id is ",n);var s="\n      SELECT inspector_array\n      FROM inf_26\n      WHERE id = ".concat(n,";\n  ");C.query(s,(function(e,t){if(e)r.status(500).json({error:"Error fetching inspector_array"});else{var s=JSON.parse(t[0].inspector_array).findIndex((function(e){return e.name===o}));if(-1!==s){var a="\n            SELECT JSON_EXTRACT(inspector_array, '$[".concat(s,'].units\') as units\n            FROM inf_26\n            WHERE JSON_CONTAINS(inspector_array, \'{"name": "').concat(o,"\"}', '$') AND id = \"").concat(n,'"\n        \n            ');C.query(a,(function(e,t){if(e)r.status(500).json({error:"Error fetching units value"});else{var o=t.length>0?t[0].units:null;console.log("count is ",o),r.status(200).json(o)}}))}else r.status(404).json({error:"Record not found"})}}))})),N.get("/api/countRecords1",(function(e,r){var t=e.query.name;console.log(t);var o="SELECT * FROM inf_26 WHERE JSON_CONTAINS(inspector_array, ".concat(C.escape('{"name": "'.concat(t,'", "i_approved": 0,"i_rejected":0}')),")");C.query(o,(function(e,t){e?r.status(500).json({error:"Error fetching record count"}):r.status(200).json(t)}))})),N.get("/api/countRecords2",(function(e,r){var t=e.query.name;console.log(t);var o="SELECT * FROM inf_26 WHERE JSON_CONTAINS(inspector_array, ".concat(C.escape('{"name": "'.concat(t,'", "i_approved": 1}')),")");C.query(o,(function(e,t){e?r.status(500).json({error:"Error fetching record count"}):r.status(200).json(t)}))})),N.get("/api/countRecords22",(function(e,r){var t=e.query.name;console.log(t);var o="SELECT * FROM inf_26 WHERE JSON_CONTAINS(inspector_array, ".concat(C.escape('{"name": "'.concat(t,'", "i_approved": 1}')),") and \tmailset_status=1");C.query(o,(function(e,t){e?r.status(500).json({error:"Error fetching record count"}):r.status(200).json(t)}))})),N.get("/api/countRecords3",(function(e,r){var t=e.query.name;console.log(t),C.query("SELECT * FROM inf_26 WHERE i_rejected=1",(function(e,t){e?r.status(500).json({error:"Error fetching record count"}):r.status(200).json(t)}))})),N.put("/api/approveRecords",(function(e,r){var t=e.query,o=t.id,n=t.reason,s=t.name;C.query("SELECT name_reason, inspector_array FROM inf_26 WHERE id = ?",[o],(function(e,t){if(e)console.error("Error retrieving record:",e),r.status(500).json({error:"Error retrieving record"});else{var a=t[0].name_reason||"{}",i=t[0].inspector_array||"[]";try{var c=JSON.parse(a),u=JSON.parse(i);c[s]=n,JSON.stringify(c);var l=u.findIndex((function(e){return e.name===s}));if(-1!==l){u[l].i_approved=1;var d=JSON.stringify(u);C.query("UPDATE inf_26 SET inspector_array = ? WHERE id = ?",[d,o],(function(e,t){e?(console.error("Error updating record:",e),r.status(500).json({error:"Error updating record"})):r.status(200).json({message:"Record approved successfully"})}))}else r.status(404).json({message:"Record not found in inspector_array"})}catch(e){console.error("Error parsing JSON:",e),r.status(500).json({error:"Error parsing JSON"})}}}))})),N.put("/api/approveRecords3",(function(e,r){var t=e.query,o=t.id,n=t.reason,s=t.name;C.query("SELECT name_reason, inspector_array FROM inf_26 WHERE id = ?",[o],(function(e,t){if(e)console.error("Error retrieving record:",e),r.status(500).json({error:"Error retrieving record"});else{var a=t[0].name_reason||"{}",i=t[0].inspector_array||"[]";try{var c=JSON.parse(a),u=JSON.parse(i);c[s]=n;var l=JSON.stringify(c),d=u.findIndex((function(e){return e.name===s}));if(-1!==d){u[d].i_rejected=1;var _=JSON.stringify(u);C.query("UPDATE inf_26 SET reason = ?, name_reason = ?, inspector_array = ? WHERE id = ?",[n,l,_,o],(function(e,t){e?(console.error("Error updating record:",e),r.status(500).json({error:"Error updating record"})):r.status(200).json({message:"Record approved successfully"})}))}else r.status(404).json({message:"Record not found in inspector_array"})}catch(e){console.error("Error parsing JSON:",e),r.status(500).json({error:"Error parsing JSON"})}}}))})),N.post("/api/update_r_inf_26",(function(e,r){var t=e.body,o=t.c_no,n=t.i_rejected;C.query("UPDATE inf_26 SET i_rejected = ? WHERE contract_number = ?",[n,o],(function(e,t){if(e)return console.error("Error updating data:",e),void r.status(500).json({success:!1,message:"Error updating data"});console.log("Data updated successfully"),r.status(200).json({success:!0,message:"Data updated successfully"})}))})),N.post("/api/insp_check_list_ADD",(function(e,r){var t=e.body,o=t.description,n=t.dropdown,s=t.parts,a=t.photo,i=t.product,c=t.reference;console.log(n,s,a,i,c),C.query("INSERT INTO inspection_master(Product, Parts, Description, Reference, Risklevel, Photo, Dropdown) VALUES (?,?,?,?,?,?,?)",[i,s,o,c,"---",a,n],(function(e,t){e?(console.error("Error updating record:",e),r.status(500).json({error:"Error updating record"})):r.status(200).json({message:"Record insert successfully"})}))})),N.put("/api/insp_check_list_update",(function(e,r){console.log("Route hit"),console.log("update works");var t=e.body,o=t.description,n=t.dropdown,s=t.parts,a=t.photo,i=t.product,c=t.reference;console.log("Request Body:",e.body);var u="UPDATE inspection_master SET Product=?, Parts=?, Description=?, Reference=?, Risklevel=?, Photo=?, Dropdown=? WHERE Description=?";console.log("Update Query:",u),C.query(u,[i,s,o,c,"---",a,n,o],(function(e,t){return e?(console.error("Error:",e),r.status(500).json({error:"Internal Server Error",message:e.message})):0===t.affectedRows?(console.log("No rows affected"),r.status(404).json({error:"Existing data not found"})):(console.log("Update success"),void r.json({message:"Updated successfully"}))}))})),N.delete("/api/inspection_delete",(function(e,r){var t=e.query.items;C.query("DELETE FROM inspection_master WHERE id = ?",[t],(function(e,t){return e?(console.error("Error deleting item from inspection_master:",e),r.status(500).json({error:"Internal Server Error"})):0===t.affectedRows?r.status(404).json({error:"Item not found in inspection_master"}):r.status(204).send()}))})),N.listen(w,(function(){console.log("Server is running on port ".concat(w))}))})();